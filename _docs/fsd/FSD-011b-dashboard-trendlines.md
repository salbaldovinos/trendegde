# FSD-011b: Dashboard Home & Trendline Views

**TrendEdge -- AI-Powered Futures Trading Platform**

| Field | Value |
|---|---|
| FSD ID | FSD-011b |
| Source | FSD-011 (Frontend Dashboard & UI/UX) |
| Title | Dashboard Home & Trendline Views |
| Version | 1.0 |
| Status | Draft |
| Author | Generated by Claude |
| Created | 2026-02-11 |

---

## 1. Introduction

### 1.1 Purpose

This sub-FSD specifies the Dashboard Home page and Trendline Detection page of the TrendEdge frontend. These two pages are the primary landing and analysis surfaces of the application: the Dashboard provides an at-a-glance overview of trading performance and positions, while the Trendlines page provides the core charting and trendline analysis workflow.

A developer should be able to implement every widget, interaction, state, and edge case described here without referencing the parent FSD or PRD.

### 1.2 Scope

This document covers:

- **Dashboard Home** (`/dashboard`): P&L summary card, active positions widget, active trendline alerts widget, recent trades widget, quick stats bar with period selector.
- **Trendline Detection Page** (`/trendlines`): Interactive candlestick chart (TradingView Lightweight Charts), trendline overlays with grade-based color coding, trendline list panel (Active/Triggered/Expired tabs), trendline detail panel with alert configuration, instrument selector with favorites, and detection configuration panel with presets.

### 1.3 Out of Scope

- Application shell, sidebar, header, command palette, breadcrumbs [see FSD-011a]
- Trade execution page, pending signals, manual trade form [see FSD-011c]
- Trade journal page, trade detail view, journal enrichment [see FSD-011c]
- Analytics dashboard, metrics, charts [see FSD-011d]
- Playbook management [see FSD-011d]
- Settings pages, onboarding, AI chat [see FSD-011e]
- Design system tokens and responsive breakpoints [see FSD-011a]
- Backend API implementation [see FSD-002 through FSD-010]

### 1.4 Tech Stack (relevant to this subsystem)

| Layer | Technology | Version | Usage |
|---|---|---|---|
| Framework | Next.js (App Router) | 14+ | Page routing, SSR |
| Language | TypeScript | 5.3+ | Type safety |
| Styling | Tailwind CSS | 3.4+ | Utility styling |
| Components | shadcn/ui | Latest | Cards, badges, dropdowns, tooltips |
| Charting (Financial) | TradingView Lightweight Charts | 4.x | Candlestick chart, trendline overlays |
| State Management | Zustand | 4.x | Selected instrument, trendline, detection params |
| Data Fetching | TanStack Query (React Query) | 5.x | API data fetching, caching |
| Real-time | WebSocket (Supabase Realtime) | N/A | Position updates, trendline alerts |
| Date Handling | date-fns | Latest | Relative time formatting |
| Icons | Lucide React | Latest | All iconography |

### 1.5 Cross-References

| Referenced FSD | What This Document Consumes |
|---|---|
| FSD-011a | App shell context (sidebar, header, theme, Paper/Live mode indicator, toast system, loading state patterns, error boundary patterns) |
| FSD-002 | Trendline entity shape, detection parameters |
| FSD-003 / FSD-005 | Position data, signal data, broker connection status |
| FSD-008 | Analytics summary metrics for quick stats |
| FSD-010 | Market data for candlestick chart |

---

## 2. Dashboard Home Page

**Route**: `/dashboard`

### 2.1 Today's P&L Summary Card

**Source**: FE-FR-008

**Description**: A prominent full-width card at the top of the dashboard showing the day's profit and loss.

**Layout**: Full width of the content area. Centered content. Padding: `p-6`.

**Content Elements**:

| Element | Typography | Color Logic |
|---|---|---|
| Label: "Today's P&L" | `text-sm text-muted-foreground font-medium` | Always muted |
| Dollar Amount | `text-3xl font-bold font-mono` | Positive: `--profit`. Negative: `--loss`. Zero: `--muted-foreground` |
| Percentage | `text-sm font-mono` | Same color logic as dollar amount |
| Vs. Yesterday | `text-xs text-muted-foreground` | Arrow icon: ArrowUp (green) if better, ArrowDown (red) if worse |

**Formatting Rules**:
- Dollar amounts: Always prefixed with `$` or `-$`. Thousands separator (comma). Two decimal places. Examples: `$1,234.56`, `-$456.78`, `$0.00`.
- Percentage: Prefixed with `+` or `-`. One decimal place. Example: `+2.3%`, `-1.1%`, `0.0%`.
- "Vs. yesterday" comparison: Shows the dollar difference. Example: `ArrowUp +$230 vs. yesterday` or `ArrowDown -$150 vs. yesterday`.

**Paper Mode**: When in Paper mode, the label reads `"Today's P&L (Paper)"` instead of `"Today's P&L"`.

**Data Source**: Real-time via WebSocket on the `account` and `fills` channels. On initial load, fetched from REST API `GET /api/dashboard/pnl?period=today`.

**States**:

| State | Display |
|---|---|
| Loading | Skeleton: one large rectangle (simulating dollar amount) and one small rectangle (simulating percentage) |
| Success (with data) | Full content as described above |
| Success (zero / no trades) | `$0.00` in `--muted-foreground`, percentage `0.0%`, no comparison arrow |
| Error | "Unable to load P&L data." with "Retry" button |

**Edge Cases**:
- If the user has no trades ever (brand new account), display `$0.00` with muted styling and no comparison.
- If yesterday's data is unavailable (first day of trading), the "vs. yesterday" section is hidden.
- On weekends/holidays when markets are closed, display the last trading day's P&L with a note: "Markets closed. Showing last trading day."

---

### 2.2 Active Positions Widget

**Source**: FE-FR-009

**Description**: A card displaying all currently open positions in a compact table.

**Table Columns**:

| Column | Width | Alignment | Format |
|---|---|---|---|
| Instrument | Auto | Left | Symbol text (e.g., "MES") |
| Direction | 80px | Center | Colored chip: "Long" (green bg) or "Short" (red bg) |
| Contracts | 60px | Right | Integer (e.g., "2") |
| Entry Price | 100px | Right | Decimal, `font-mono` (e.g., "5,432.25") |
| Current Price | 100px | Right | Decimal, `font-mono`, updates in real-time |
| Unrealized P&L | 120px | Right | Dollar amount, `font-mono`, green/red coloring |
| % of Account | 80px | Right | Percentage, `font-mono` (e.g., "1.2%") |

**Real-Time Updates**: Current Price and Unrealized P&L columns update via WebSocket on the `positions` channel. Update frequency: 1 Hz (once per second) during market hours. A brief (300ms) background flash animation on the P&L cell indicates a value change (green flash for increase, red flash for decrease).

**Row Click**: Clicking a row navigates to `/execution?position=[id]`, scrolling to and highlighting that position in the full positions table.

**States**:

| State | Display |
|---|---|
| Loading | 3-row skeleton table with shimmer |
| Success (positions exist) | Table with all columns populated |
| Empty | "No open positions" in muted text, centered in the card |
| Error | "Unable to fetch positions. Check broker connection." with "Retry" button |

**Edge Cases**:
- All positions fit without pagination (expected max 5-10 concurrent positions).
- If WebSocket is disconnected, current prices show the last known value with a "stale" indicator (yellow clock icon) and the timestamp of the last update.

---

### 2.3 Active Trendline Alerts Widget

**Source**: FE-FR-010

**Description**: A card showing trendlines currently being monitored for alerts, sorted by quality.

**List Item Layout**: Each item is a horizontal row within the card.

| Element | Format | Position |
|---|---|---|
| Instrument | Text (e.g., "ES") | Left |
| Direction | Icon: TrendingUp for support, TrendingDown for resistance | Left of grade |
| Grade Badge | Filled badge: A+ (gold `#F59E0B`), A (blue `#3B82F6`), B (gray `#6B7280`) | Center-left |
| Touch Count | Text: "3 touches" | Center |
| Alert Status | Badge: see below | Right |

**Alert Status Visual States**:

| Status | Text | Color | Animation |
|---|---|---|---|
| Watching | "Watching" | `--muted-foreground` | None |
| Near Alert | "Near Alert" | `--alert-near` (#EAB308) | Pulse animation (2s ease-in-out infinite) |
| Triggered | "Triggered" | `--alert-triggered` (#22C55E) | Brief flash on transition, then static |

**Sorting**: Default sort by grade descending (A+ first), then by proximity to alert trigger price (closest first).

**Click Behavior**: Clicking a trendline navigates to `/trendlines?instrument=[symbol]&trendline=[id]`. The trendline chart loads with the specified instrument, and the specified trendline is highlighted.

**Maximum Items**: Show top 10 trendlines. If more than 10 exist, a footer link displays: "View all [n] trendlines" linking to `/trendlines`.

**States**:

| State | Display |
|---|---|
| Loading | 5-item skeleton list |
| Success | Sorted list of trendline items |
| Empty | Icon: TrendingUp (48px, muted). Heading: "No active trendlines." Description: "Visit the Trendlines page to scan for setups." CTA: "Scan Trendlines" button linking to `/trendlines`. |
| Error | "Unable to fetch trendlines. Retry." with "Retry" button |

---

### 2.4 Recent Trades Widget

**Source**: FE-FR-011

**Description**: A compact list of the 5 most recent closed trades.

**Each Row**:

| Element | Format | Example |
|---|---|---|
| Date | Relative time (`text-xs text-muted-foreground`) | "2h ago", "Yesterday", "3 days ago" |
| Instrument | Symbol text | "CL" |
| Direction | Text with color: "Long" (green) / "Short" (red) | "Long" |
| P&L | Dollar, `font-mono`, colored | "+$342.00" (green) or "-$198.00" (red) |
| R-Multiple | Number with 1 decimal, `font-mono` | "2.1R" or "-1.0R" |

**Click Behavior**: Clicking a row navigates to `/journal/trade/[id]`.

**Footer**: "View all trades" link to `/journal`.

**States**:

| State | Display |
|---|---|
| Loading | 5-row skeleton list |
| Success | List of trades |
| Empty | "No trades recorded yet." in muted text |
| Error | "Unable to load recent trades. Retry." |

---

### 2.5 Quick Stats Bar

**Source**: FE-FR-012

**Description**: A horizontal row of 4-5 stat cards below the P&L summary.

**Period Selector**: A dropdown above the stats bar with options: Today, This Week, This Month, All Time. Default: "This Month". Selection persists in `localStorage` under key `dashboard_stats_period`.

**Stat Cards**:

| Stat | Format | Example | Sparkline |
|---|---|---|---|
| Win Rate | Percentage + fraction | "68.2% (15/22)" | 30-day trend line |
| Account Equity | Dollar | "$52,340.00" | 30-day trend line |
| Open Risk | Dollar + percentage | "$450 (0.9%)" | No sparkline |
| Total Trades | Integer | "22" | 30-day trend line |
| Avg R-Multiple | Number, 2 decimals | "0.72R" | 30-day trend line |

**Each Card Layout**: Label (`text-xs text-muted-foreground font-medium`), Value (`text-lg font-semibold font-mono`), Sparkline (32px height, `--primary` color, no axis labels) below the value.

**Layout**: Responsive grid. 5 columns on desktop (>1280px), 3 columns on tablet (768-1280px), 2 columns on mobile (<768px).

**Data Source**: REST API `GET /api/dashboard/stats?period=[period]`.

**States**:

| State | Display |
|---|---|
| Loading | 5 skeleton cards with shimmer |
| Success | Populated stat cards |
| Empty (no trades in period) | All values show "0" or "0.0%" or "$0.00" with muted styling. No sparklines. |
| Error | "Unable to load stats. Retry." in a single card spanning full width |

---

### 2.6 Dashboard Page Layout

**Desktop (>1280px)**:
```
+-----------------------------------------------+
| P&L Summary Card (full width)                 |
+-----------------------------------------------+
| Quick Stats Bar (5 columns)                   |
+-----------------------------------------------+
| Active Positions (60%)  | Trendline Alerts (40%)|
+-----------------------------------------------+
| Recent Trades (60%)     | (empty or future)     |
+-----------------------------------------------+
```

**Tablet (768-1280px)**:
```
+-----------------------------------------------+
| P&L Summary Card (full width)                 |
+-----------------------------------------------+
| Quick Stats Bar (3 columns)                   |
+-----------------------------------------------+
| Active Positions (full width)                 |
+-----------------------------------------------+
| Trendline Alerts (full width)                 |
+-----------------------------------------------+
| Recent Trades (full width)                    |
+-----------------------------------------------+
```

**Mobile (<768px)**:
```
+-----------------------------------------------+
| P&L Summary Card (full width)                 |
+-----------------------------------------------+
| Quick Stats Bar (2 columns)                   |
+-----------------------------------------------+
| Active Positions (full width)                 |
+-----------------------------------------------+
| Trendline Alerts (full width)                 |
+-----------------------------------------------+
| Recent Trades (full width)                    |
+-----------------------------------------------+
```

---

## 3. Trendline Detection Page

**Route**: `/trendlines`

### 3.1 Interactive Candlestick Chart

**Source**: FE-FR-013

**Description**: The primary charting area occupying approximately 65% of the page width (left side) on desktop, full width on mobile.

**Chart Engine**: TradingView Lightweight Charts library (v4.x).

**Chart Type**: Candlestick (OHLC). Green candles when close > open. Red candles when close < open.

**Default Configuration**:
- Default timeframe: 4H (primary analysis timeframe per Tori Trades methodology).
- Default instrument: User's configured default instrument from settings, fallback to MES.
- Initial candle count: 300 candles loaded on first render.

**Timeframe Selector**: Horizontal button group positioned above the chart.

| Button | Timeframe | Label |
|---|---|---|
| 1 | 1 Hour | "1H" |
| 2 | 4 Hours | "4H" (highlighted by default) |
| 3 | Daily | "D" |
| 4 | Weekly | "W" |

Active button styling: `--primary` background with white text. Inactive: `--secondary` background with `--foreground` text.

Changing timeframe triggers a full chart data refetch. The trendline list also refreshes for the new timeframe. A loading skeleton replaces the chart during the fetch (not a spinner).

**Interactions**:
- Scroll wheel: Zoom in/out (centered on cursor position).
- Click-drag: Pan left/right through time.
- Double-click: Reset zoom to default view (last 300 candles).
- Pinch-to-zoom: Supported on touch devices.
- Crosshair: Vertical + horizontal dashed lines follow cursor. Price label appears on Y-axis (right), date/time label on X-axis (bottom).

**Axes**:
- Price axis (Y): Right side. Auto-scaling with 10% headroom above the highest visible candle and 10% below the lowest. Formatted with commas and appropriate decimal places for the instrument.
- Time axis (X): Bottom. Format: "Jan 15" for daily/weekly timeframes, "Jan 15 09:00" for intraday (1H/4H).

**Data Source**: REST API via BFF: `GET /api/market-data/{instrument}/{timeframe}?count=300&before={timestamp}`.

**Pagination**: When the user pans left to the beginning of loaded data, a loading indicator appears at the left edge and an additional batch of 300 candles loads. This continues until no more historical data is available.

**Performance**: Chart render (300 candles + 5 trendlines) must complete within 16ms per frame with no frame drops. Charts with up to 2,000 candles must render without frame drops.

**States**:

| State | Display |
|---|---|
| Loading | Chart area skeleton with axis placeholders and shimmer |
| Success | Rendered candlestick chart with data |
| Empty | "Select an instrument to view trendlines" centered in chart area |
| Error | "Unable to load chart data." with "Retry" button centered in chart area |

**Edge Cases**:
- If fewer than 300 candles exist for a new instrument, render all available candles.
- If the market is closed, the chart shows the most recent available data. No candles render beyond the last available bar.
- If the API returns an empty dataset (instrument has no data), show empty state.

---

### 3.2 Trendline Overlays

**Source**: FE-FR-014

**Description**: Detected trendlines rendered as line overlays on the candlestick chart.

**Line Rendering**: Each trendline is drawn as a straight line from its first touch point to its last touch point, extended to the right edge of the visible chart area.

**Color Coding by Grade**:

| Grade | Color | Hex | Line Width | Line Style |
|---|---|---|---|---|
| A+ | Gold/amber | `#F59E0B` | 2px | Solid |
| A | Blue | `#3B82F6` | 1.5px | Solid |
| B | Gray | `#6B7280` | 1px | Dashed (4px dash, 4px gap) |

**Touch Point Markers**: Small circles (6px diameter) rendered at each confirmed touch point on the trendline. Circle fill color matches the trendline color. On hover over a touch point: tooltip showing the touch date and price (e.g., "Jan 15, 2026 - $5,432.25").

**Selection Behavior**:
1. User clicks on a trendline.
2. The selected trendline's line width increases to 3px.
3. A glow effect is applied (CSS `filter: drop-shadow(0 0 6px [line-color])` at 50% opacity).
4. The trendline detail panel (3.4) populates with this trendline's data.
5. Clicking the chart background (not on a trendline) deselects the current trendline.

**Alert Zone Visualization**: When the current price is within 1x ATR (Average True Range) of a trendline, the area between the trendline and the current price is shaded with a semi-transparent fill (10% opacity of the trendline's color).

**Visibility Toggle**: Each trendline can be toggled visible/hidden via its checkbox in the trendline list panel (3.3). Hidden trendlines are not rendered on the chart.

**Performance**: Up to 100 trendlines per instrument must render without frame drops (< 16ms render time per frame).

---

### 3.3 Trendline List Panel

**Source**: FE-FR-015

**Description**: A scrollable list panel on the right side (approximately 35% width on desktop, full width below chart on mobile).

**Tab Bar**: Three tabs at the top of the panel.

| Tab | Content | Default |
|---|---|---|
| Active | Trendlines currently being monitored | Selected by default |
| Triggered | Trendlines whose alerts have fired | |
| Expired | Trendlines no longer valid (broken/aged out) | |

**Each List Item**:

| Element | Format | Position |
|---|---|---|
| Visibility checkbox | Checkbox (checked = visible on chart) | Far left |
| Direction icon | TrendingUp (support) or TrendingDown (resistance) | Left |
| Grade badge | A+ (gold), A (blue), B (gray) filled badge | After icon |
| Touch count | "3 touches" (text-sm) | Center |
| Slope angle | "28 deg" (text-sm, muted) | Center |
| Duration | "5 weeks" (text-sm, muted) | Center |
| Alert status | Watching / Near / Triggered badge | Right |
| Quality score | 0-100 with mini progress bar (32px wide) | Far right |

**Sort Dropdown**: Options: Score (default, descending), Touch Count (descending), Duration (descending), Proximity to Price (ascending, closest first).

**Selection**: Clicking an item highlights the corresponding trendline on the chart and opens the detail panel (3.4). The selected item has a `--muted` background highlight.

**Bulk Actions**: A "Dismiss" button appears when one or more items are selected via checkboxes. Dismissing removes the trendline from the active list and sends a `PATCH /api/trendlines/{id}` with `status: "dismissed"` to the backend.

**Empty States**:
- Active tab empty: "No trendlines detected for [instrument]. Adjust parameters or try another instrument."
- Triggered tab empty: "No triggered trendlines yet."
- Expired tab empty: "No expired trendlines."

---

### 3.4 Trendline Detail Panel

**Source**: FE-FR-016

**Description**: A slide-over panel or expanded section that appears when a trendline is selected from the list or clicked on the chart.

**Header**: Instrument symbol + Direction text (Support/Resistance) + Grade badge.

**Metrics Grid (2 columns)**:

| Metric | Format | Example |
|---|---|---|
| Touch Points | Count + expandable list of date/price pairs | "4 touches" -> ["Jan 5 - $5,400", "Jan 19 - $5,420", ...] |
| Slope | Degrees + small visual gauge (arc indicator) | "28 deg" |
| Spacing | Average candle count between touches | "18 candles avg" |
| Duration | Timespan from first to last touch | "6 weeks 3 days" |
| Quality Score | 0-100 with color gradient bar (red->yellow->green) | "87 / 100" |
| Current Distance | ATR-normalized | "0.4 ATR" |

**Alert Configuration Section**:
- Enable/disable alert: Toggle switch. Label: "Alert enabled".
- Alert type: Dropdown with options: "Break" (price crosses through trendline), "Touch" (price touches and bounces), "Both".
- Notification channels: Checkboxes for: Dashboard, Telegram, Discord, Email. Default: Dashboard checked, others unchecked.

**Action Buttons**:
- "Set Alert" (primary variant): Saves the alert configuration. On success: toast "Alert set for [Instrument] [Direction] trendline." On failure: toast (error) "Failed to set alert. Please try again."
- "Dismiss" (secondary variant): Confirmation required. Dialog: "Dismiss this trendline?" with "This removes it from your active list. You can find it later in the Expired tab." Confirm button: "Dismiss". Cancel button: "Keep".
- "View Trades" (text link): Only displayed if trades exist that reference this trendline. Links to `/journal?trendline=[id]`.

**History Section**: A collapsible accordion labeled "Alert History". Lists past alert triggers with: date, type (Break/Touch), price at trigger, action taken (Executed/Rejected/Expired). Empty state: "No alert history for this trendline."

---

### 3.5 Instrument Selector

**Source**: FE-FR-017

**Description**: A searchable dropdown for switching between instruments, positioned above the chart.

**Display When Closed**: Shows the currently selected instrument: symbol in bold + full name + current price + daily change percentage (colored green/red).

**Dropdown Content**:
- Search input at top (auto-focused on open). Placeholder: "Search instruments..."
- "Favorites" section (user-pinned instruments, stored in user settings). Each item has a filled star icon.
- "All Instruments" section (alphabetically sorted).

**Supported Instruments (MVP)**:

| Symbol | Full Name |
|---|---|
| ES | E-mini S&P 500 |
| NQ | E-mini Nasdaq 100 |
| CL | Crude Oil |
| GC | Gold |
| PL | Platinum |
| YM | E-mini Dow |
| MES | Micro E-mini S&P 500 |
| MNQ | Micro E-mini Nasdaq 100 |

**Each Item in Dropdown**: Symbol (bold) + Full name + Current price (`font-mono`) + Daily change % (colored green positive, red negative). Star icon (outline for non-favorites, filled for favorites; click star to toggle favorite without closing dropdown).

**On Instrument Change**:
1. Chart re-renders with the new instrument's candle data.
2. Trendline list refreshes for the new instrument.
3. URL updates to `/trendlines?instrument=[symbol]`.
4. The instrument selector closes.

**Keyboard**: Typing while the dropdown is focused filters the instrument list by substring match (case-insensitive).

---

### 3.6 Detection Configuration Panel

**Source**: FE-FR-018

**Description**: A collapsible accordion panel for tuning trendline detection parameters. Located below the trendline list panel or as a separate tab/section.

**Parameters**:

| Parameter | Input Type | Default | Min | Max | Step | Tooltip |
|---|---|---|---|---|---|---|
| Min Touch Count | Slider + number input | 3 | 2 | 5 | 1 | "Minimum pivot points that must intersect the trendline" |
| Min Candle Spacing | Slider + number input | 6 | 3 | 20 | 1 | "Minimum 4H candles between consecutive touches" |
| Max Slope Angle | Slider + number input | 45 | 15 | 75 | 1 | "Maximum angle relative to horizontal (lower = flatter)" |
| Min Duration | Dropdown | "3 weeks" | N/A | N/A | N/A | "Minimum time from first touch to current" |
| Touch Tolerance | Slider + number input | 0.5 | 0.2 | 1.5 | 0.1 | "ATR multiplier for touch proximity (lower = stricter)" |
| Pivot Sensitivity | Slider + number input | 5 | 2 | 10 | 1 | "N-bar lookback for swing point detection" |

Min Duration dropdown options: 1w, 2w, 3w, 1m, 2m, 3m, 6m.

**Validation**:
- Number inputs reject non-numeric characters.
- Values outside the min/max range snap to the nearest valid value on blur.
- Slider and number input are synchronized: changing one updates the other.

**Preset Buttons**:

| Preset | Settings Applied |
|---|---|
| "Tori Trades A+" | Min touches: 3, Spacing: 6, Max slope: 45, Duration: 3w, Tolerance: 0.5, Pivot: 5 |
| "Relaxed" | Min touches: 2, Spacing: 3, Max slope: 75, Duration: 1w, Tolerance: 1.5, Pivot: 3 |
| "Strict" | Min touches: 4, Spacing: 10, Max slope: 30, Duration: 1m, Tolerance: 0.3, Pivot: 7 |

Clicking a preset immediately populates all fields with its values. The "Apply" button must still be clicked to trigger a re-scan.

**Actions**:
- "Apply" button (primary): Sends parameters to `POST /api/trendlines/scan` with the current instrument and parameters. Chart and list reload with new results. Toast on success: "Scan complete. Found [n] trendlines." Toast on error: "Scan failed. Please try again."
- "Reset to Default" button (secondary): Restores all fields to the "Tori Trades A+" preset values.

**Persistence**: Custom settings are saved per-user via `PUT /api/settings/detection-defaults`. On page visit, the last-used settings are loaded from the API.

---

### 3.7 Trendlines Page Layout

**Desktop (>1280px)**:
```
+------------------------------------------+-------------------+
| Instrument Selector | Timeframe Buttons  | Sort Dropdown     |
+------------------------------------------+-------------------+
|                                          | Trendline List    |
|    Candlestick Chart                     | [Active|Trig|Exp] |
|    (with trendline overlays)             |                   |
|    ~65% width                            | List items...     |
|                                          | ~35% width        |
|                                          |                   |
|                                          +-------------------+
|                                          | Detection Config  |
|                                          | (collapsible)     |
+------------------------------------------+-------------------+
```

When a trendline is selected, the detail panel replaces or overlays the list panel content.

**Mobile (<768px)**:
```
+-----------------------------------------------+
| Instrument Selector | Timeframe Buttons       |
+-----------------------------------------------+
| Candlestick Chart (full width)                |
+-----------------------------------------------+
| [Active | Triggered | Expired] tabs           |
| Trendline List (full width, scrollable)       |
+-----------------------------------------------+
| Detection Config (collapsible accordion)      |
+-----------------------------------------------+
```

---

## 4. Data Specifications

### 4.1 Client-Side Data Models

#### 4.1.1 Position

```typescript
interface Position {
  id: string;
  instrument: string;
  direction: "long" | "short";
  contracts: number;
  entry_price: number;
  current_price: number;         // Updated via WebSocket
  stop_loss: number;
  take_profit: number | null;
  unrealized_pnl: number;       // Updated via WebSocket
  r_multiple: number;
  mae_ticks: number;
  mfe_ticks: number;
  entry_time: string;
  signal_source: string;
  trendline_id: string | null;
  mode: "paper" | "live";
}
```

#### 4.1.2 Trendline

```typescript
interface Trendline {
  id: string;
  instrument: string;
  direction: "support" | "resistance";
  grade: "A+" | "A" | "B";
  touch_count: number;
  touch_points: TouchPoint[];
  slope_degrees: number;
  spacing_candles: number;       // Avg candle count between touches
  duration_days: number;
  quality_score: number;         // 0-100
  current_distance_atr: number;  // ATR-normalized distance
  alert_status: "watching" | "near" | "triggered" | "dismissed" | "expired";
  alert_enabled: boolean;
  alert_type: "break" | "touch" | "both" | null;
  notification_channels: string[];
  status: "active" | "triggered" | "expired" | "dismissed";
  created_at: string;
}

interface TouchPoint {
  date: string;     // ISO 8601
  price: number;
}
```

#### 4.1.3 Trade (summary for dashboard widget)

```typescript
interface TradeSummary {
  id: string;
  instrument: string;
  direction: "long" | "short";
  pnl_dollars: number;
  r_multiple: number;
  exit_time: string;             // ISO 8601
}
```

#### 4.1.4 Dashboard Stats

```typescript
interface DashboardStats {
  win_rate: number;              // 0-100
  win_count: number;
  total_count: number;
  account_equity: number;
  open_risk_dollars: number;
  open_risk_percent: number;
  total_trades: number;
  avg_r_multiple: number;
  sparklines: {
    win_rate: number[];          // 30 data points
    equity: number[];
    total_trades: number[];
    avg_r: number[];
  };
}
```

#### 4.1.5 P&L Summary

```typescript
interface PnlSummary {
  today_pnl_dollars: number;
  today_pnl_percent: number;
  yesterday_pnl_dollars: number | null;
  is_market_closed: boolean;
  last_trading_day: string | null;  // ISO 8601 date if showing stale data
}
```

### 4.2 Zustand Stores (relevant to this subsystem)

| Store | State | Persisted |
|---|---|---|
| `useUIStore` | `dashboardStatsPeriod` | localStorage |
| `useTrendlineStore` | `selectedInstrument`, `selectedTrendline`, `detectionParams` | URL params + API |
| `usePositionsStore` | `positions[]`, `lastUpdate` | No (WebSocket-driven) |

### 4.3 Caching Strategy (TanStack Query)

| Data Type | Stale Time | Cache Time | Refetch On |
|---|---|---|---|
| Dashboard P&L | 30 seconds | 5 minutes | WebSocket `account`/`fills` event, window focus |
| Dashboard positions | 30 seconds | 5 minutes | WebSocket `positions` event, window focus |
| Dashboard trendlines | 1 minute | 5 minutes | WebSocket `trendlines` event, window focus |
| Dashboard recent trades | 2 minutes | 10 minutes | Window focus, mutation |
| Dashboard stats | 5 minutes | 30 minutes | Period change, window focus |
| Market data (candles) | 30 seconds | 10 minutes | Timeframe/instrument change |
| Trendline list | 1 minute | 5 minutes | Instrument change, scan, WebSocket `trendlines` event |
| Detection params | 1 hour | 24 hours | Mutation |

---

## 5. API Specifications

### 5.1 Dashboard Endpoints

| Method | BFF Route | Backend Route | Description |
|---|---|---|---|
| GET | `/api/dashboard/pnl` | `/v1/dashboard/pnl?period=today` | Today's P&L summary |
| GET | `/api/dashboard/positions` | `/v1/positions?status=open` | Active positions |
| GET | `/api/dashboard/trendlines` | `/v1/trendlines?status=active&limit=10` | Top 10 active trendlines |
| GET | `/api/dashboard/recent-trades` | `/v1/trades?status=closed&limit=5&sort=-entry_time` | Last 5 closed trades |
| GET | `/api/dashboard/stats` | `/v1/analytics/summary?period=[period]` | Quick stats for selected period |

### 5.2 Trendlines Endpoints

| Method | BFF Route | Description |
|---|---|---|
| GET | `/api/market-data/{instrument}/{timeframe}` | Candlestick data (paginated by `?count=300&before={timestamp}`) |
| GET | `/api/trendlines?instrument={symbol}&status={status}` | Trendline list for instrument |
| GET | `/api/trendlines/{id}` | Trendline detail |
| POST | `/api/trendlines/scan` | Trigger re-scan with custom parameters |
| PATCH | `/api/trendlines/{id}` | Update trendline (dismiss, alert config) |

### 5.3 Settings Endpoints (relevant to this subsystem)

| Method | BFF Route | Description |
|---|---|---|
| GET | `/api/settings/detection-defaults` | Get saved detection parameters |
| PUT | `/api/settings/detection-defaults` | Save detection parameters |

### 5.4 WebSocket Channels (relevant to this subsystem)

| Channel | Event | UI Update |
|---|---|---|
| `positions` | Position opened/closed/updated | Dashboard positions widget, P&L card |
| `fills` | Order filled | P&L card update |
| `trendlines` | New trendline detected / alert triggered | Dashboard trendline alerts widget, trendline list, chart overlay |
| `account` | Balance/margin update | Dashboard P&L card, equity stat |

### 5.5 Error Handling

All API errors follow the standard envelope:

| HTTP Status | Frontend Behavior |
|---|---|
| 200-299 | Process response, update UI |
| 400 | Display validation errors inline (e.g., detection config out of range) |
| 401 | Attempt token refresh. If fails: redirect to `/login`, toast "Session expired." |
| 404 | Show component-specific "not found" state |
| 429 | Toast (warning): "Too many requests. Please wait a moment." Retry with backoff. |
| 500 | Toast (error): "Something went wrong." Log to Sentry. Show retry button. |
| Timeout (>10s) | Toast (error): "Request timed out. Please try again." |
| Network error | Toast (error): "Network error. Please check your connection." |

---

## 6. Performance Specifications

### 6.1 Response Time Requirements

| Operation | Target | Notes |
|---|---|---|
| Dashboard page load (all widgets) | < 2 seconds | All 5 widgets render with data |
| Instrument change (chart + trendlines) | < 1.5 seconds | Full re-render with new data |
| Timeframe change (chart) | < 1.5 seconds | Chart re-render with new candle data |
| Trendline scan (Apply button) | < 3 seconds | Detection + list refresh + chart overlay update |
| Chart render (300 candles + 5 trendlines) | < 16ms per frame | No frame drops |
| Chart render (2,000 candles) | No frame drops | TradingView Lightweight Charts native handling |
| Trendline overlay render (100 trendlines) | < 16ms per frame | No frame drops |
| WebSocket position update to UI | < 200ms | From message receipt to rendered DOM change |
| Position P&L real-time update | 1 Hz (1 update/second) | Without dropped frames |

### 6.2 Data Volume Handling

| Data | Volume Limit | Strategy |
|---|---|---|
| Chart candles | Up to 2,000 | TradingView Lightweight Charts native handling, paginated loading |
| Trendlines per instrument | Up to 100 | Direct rendering (no virtualization needed) |
| Concurrent open positions | Up to 10 | Direct rendering |
| Dashboard trendline alerts | Max 10 displayed | API limit param |
| Dashboard recent trades | Max 5 displayed | API limit param |

---

## 7. Testing Specifications

### 7.1 Unit Tests

| Component / Feature | Test Cases |
|---|---|
| P&L Summary Card | Renders positive P&L in green, negative in red, zero in muted. Shows "(Paper)" label in paper mode. Shows "Markets closed" on weekends. Hides "vs. yesterday" when no yesterday data. |
| Active Positions Widget | Renders correct column data. Shows empty state when no positions. Shows stale indicator when WebSocket disconnected. Row click navigates to execution page. |
| Trendline Alerts Widget | Sorts by grade then proximity. Near Alert badge pulses. Click navigates with correct query params. Shows "View all" footer when >10 trendlines. Empty state shows CTA button. |
| Recent Trades Widget | Renders 5 items max. P&L colors correct. Relative time formatted properly. Click navigates to journal detail. |
| Quick Stats Bar | Period selector persists to localStorage. Stats update on period change. Sparklines render at correct height. Empty period shows zero values. |
| Candlestick Chart | Renders 300 candles. Zoom in/out via scroll wheel. Pan left loads more data. Double-click resets view. Timeframe button changes active state. |
| Trendline Overlays | Correct color by grade (A+=gold, A=blue, B=gray dashed). Touch point tooltips display date+price. Selected trendline has increased width and glow. Alert zone shading appears within 1 ATR. Visibility checkbox hides/shows line. |
| Trendline List Panel | Tab switching shows correct items. Sort dropdown changes order. Selection highlights chart overlay. Dismiss sends PATCH request. |
| Trendline Detail Panel | Metrics grid shows correct values. Alert toggle saves config. "Set Alert" shows success toast. "Dismiss" requires confirmation. "View Trades" only shown when trades exist. |
| Instrument Selector | Search filters by substring. Favorites section shows pinned instruments. Star toggle updates without closing dropdown. Instrument change updates chart and URL. |
| Detection Configuration | Slider and number input sync. Values snap to range on blur. Presets populate all fields. "Apply" triggers scan. "Reset" restores defaults. Settings persist via API. |

### 7.2 End-to-End Tests

| # | Journey | Key Assertions |
|---|---|---|
| 1 | Dashboard Load | All 5 widgets render with data. P&L card shows correct amount. Positions widget shows open trades. Trendline alerts sorted by grade. Recent trades show 5 items. |
| 2 | Dashboard Empty State | New user sees $0.00 P&L, "No open positions", "No active trendlines" with CTA, "No trades recorded yet." |
| 3 | Dashboard Real-Time Update | Open a position via another tab/API. Position appears in widget. P&L updates. |
| 4 | Trendline Interaction | Select instrument -> chart renders -> trendlines appear -> click trendline -> detail panel shows correct data -> set alert -> toast confirms -> dismiss trendline -> removed from active list |
| 5 | Detection Config | Load page -> adjust min touch count slider -> verify number input syncs -> click "Strict" preset -> verify all fields update -> click "Apply" -> verify scan results in toast -> verify chart and list update |
| 6 | Instrument Change | Select new instrument -> chart re-renders -> trendlines refresh -> URL updates with ?instrument= param -> back button returns to previous instrument |
| 7 | Timeframe Change | Click "D" timeframe -> chart re-renders with daily candles -> trendline list refreshes -> click "4H" returns to default |

### 7.3 Visual Regression Scenarios

- Dashboard (all widgets loaded, dark theme)
- Dashboard (all widgets loaded, light theme)
- Dashboard (empty state, no trades/positions)
- Dashboard (Paper mode label)
- Trendline chart with overlays (A+, A, B grade lines)
- Trendline detail panel open
- Instrument selector dropdown open
- Detection config panel expanded with "Strict" preset

### 7.4 Accessibility Tests

- Dashboard: all widgets reachable via Tab. P&L card values have `aria-label` with full text.
- Trendline overlays: chart has `aria-label` describing data trends.
- Trendline list: items navigable via keyboard. Selection state announced via `aria-selected`.
- Instrument selector: dropdown navigable via arrow keys. Search input auto-focused.
- Detection config: sliders have `aria-label` and `aria-valuenow`. Tooltips accessible via keyboard focus.

---

## 8. Cross-References

| Sibling FSD | Integration Point |
|---|---|
| **FSD-011a** (App Shell & Navigation) | Sidebar navigation, header bar (Paper/Live indicator, notification bell), toast system, loading/error patterns, theme, responsive breakpoints |
| **FSD-011c** (Execution & Journal Views) | Dashboard positions widget links to `/execution?position=[id]`. Recent trades link to `/journal/trade/[id]`. |
| **FSD-011d** (Analytics & Playbook Views) | Quick stats bar consumes analytics summary API. |
| **FSD-011e** (Settings, Onboarding & AI Chat) | Detection config persists to settings. Instrument selector favorites stored in user settings. |

| Related Backend FSD | Integration Point |
|---|---|
| **FSD-002** | Trendline entity, detection parameters, supported instruments |
| **FSD-003 / FSD-005** | Position data, signal data for pending signals badge |
| **FSD-008** | Analytics summary metrics for quick stats |
| **FSD-010** | Market data (OHLC candles) for candlestick chart |

---

## Changelog

- 2026-02-11: Initial sub-FSD extracted from FSD-011 v1.0

---

*FSD-011b v1.0 -- Dashboard Home & Trendline Views*
*TrendEdge -- February 2026*
