# FSD-011: Frontend Dashboard

**TrendEdge — AI-Powered Futures Trading Platform**

| Field | Value |
|---|---|
| FSD ID | FSD-011 |
| Source PRD | PRD-011 |
| Title | Frontend Dashboard & UI/UX |
| Version | 1.0 |
| Status | Draft |
| Author | Generated by Claude |
| Created | 2026-02-11 |

---

## 1. Introduction

### 1.1 Purpose

This Functional Specification Document (FSD) translates PRD-011 (Frontend Dashboard & UI/UX) into precise, implementable specifications. It documents every user-facing behavior, state transition, error message, validation rule, and edge case required to build the TrendEdge frontend dashboard. A developer should be able to implement any feature described here without referencing the source PRD or asking clarifying questions.

### 1.2 Scope

**This document covers:**

- Application shell: sidebar navigation, header bar, breadcrumbs, Paper/Live mode indicator
- Dashboard home page: P&L summary, active positions, trendline alerts, recent trades, quick stats
- Trendline detection page: candlestick chart, trendline overlays, list/detail panels, instrument selector, detection configuration
- Trade execution page: active positions table, pending signals queue, manual trade entry, broker status, Paper/Live toggle
- Trade journal page: trade table, trade detail view, journal enrichment, screenshot upload, search/filter
- Playbook management: list, detail, CRUD, comparison
- Analytics dashboard: 27 metrics, equity curve, P&L calendar heatmap, R-multiple histogram, time-based charts, MAE/MFE scatter plots, drawdown chart
- Settings: profile, trading preferences, broker connections, notifications, detection defaults, risk management, appearance
- AI chat interface: conversational analytics
- Onboarding wizard (Phase 3)
- Landing page (Phase 3)
- Real-time WebSocket integration
- Design system: colors, typography, spacing, icons, motion, status indicators
- Responsive design, theme system, keyboard shortcuts, accessibility
- Loading, error, and empty states for every view

**This document does NOT cover:**

- Backend API implementation (see FSD-002 through FSD-010)
- Database schema design (see FSD-002)
- Authentication/authorization backend logic (see FSD-003)
- Trendline detection algorithms (see FSD-004)
- Trade execution engine internals (see FSD-005)
- Infrastructure and DevOps (see FSD-001)

### 1.3 Relationship to Source PRD

This FSD is a direct elaboration of PRD-011. Every functional requirement (FE-FR-001 through FE-FR-058), non-functional requirement (FE-NFR-001 through FE-NFR-012), and acceptance criterion (AC-FE-001 through AC-FE-P3-012) from the PRD is expanded here with full behavioral specifications.

### 1.4 Cross-References

| Referenced FSD | What This FSD Consumes |
|---|---|
| FSD-001 | Vercel hosting config, CI/CD pipeline, environment variables |
| FSD-002 | Entity shapes for TypeScript types, API response interfaces |
| FSD-003 | Login/signup flows, session management, protected routes, role-based UI |
| FSD-004 | Trendline data for chart overlays, detection configuration parameters |
| FSD-005 | Position data, signal queue, order forms, broker connection status |
| FSD-006 | Trade table data, trade detail data, enrichment form schema, screenshot storage |
| FSD-007 | Playbook CRUD APIs, playbook metrics, auto-classification rules |
| FSD-008 | All 27 metric calculations, chart data for equity curve, heatmap, histograms |
| FSD-009 | Notification preferences, notification list, real-time alert delivery |
| FSD-010 | Conversational analytics chat API, trade review content, trendline scoring |

---

## 2. System Context

### 2.1 Architecture Position

The frontend is a Next.js 14+ application deployed on Vercel. It is the sole user-facing layer of TrendEdge. Every backend service is consumed through Next.js API routes acting as a Backend-for-Frontend (BFF) proxy. The browser never communicates directly with the FastAPI backend.

### 2.2 Communication Flow

```
Browser (React) --> Next.js API Routes (BFF) --> FastAPI Backend --> PostgreSQL / Redis / S3 (R2)
Browser (React) <-- WebSocket <-- Supabase Realtime <-- FastAPI Backend
Browser (React) --> Cloudflare R2 (direct upload via presigned URL for screenshots)
```

### 2.3 External Systems

| System | Purpose | Protocol |
|---|---|---|
| FastAPI Backend | All business logic, data CRUD, analytics computation | REST (JSON) via Next.js BFF |
| Supabase Realtime | WebSocket channels for live position, fill, trendline, signal, account, and alert updates | WebSocket |
| Cloudflare R2 | Screenshot storage for trade journal | HTTPS (presigned URL upload) |
| Vercel | Hosting, edge network, preview deployments, analytics | Platform |
| Sentry | Error logging and monitoring | SDK |

### 2.4 Tech Stack

| Layer | Technology | Version |
|---|---|---|
| Framework | Next.js (App Router) | 14+ |
| Language | TypeScript | 5.3+ |
| Styling | Tailwind CSS | 3.4+ |
| Component Library | shadcn/ui | Latest |
| Charting (Financial) | TradingView Lightweight Charts | 4.x |
| Charting (Analytics) | D3.js | 7.x |
| State Management | Zustand | 4.x |
| Data Fetching | TanStack Query (React Query) | 5.x |
| Forms | React Hook Form + Zod | Latest |
| Real-time | WebSocket (native) + Supabase Realtime | N/A |
| File Upload | react-dropzone | Latest |
| Date Handling | date-fns | Latest |
| Icons | Lucide React | Latest |

---

## 3. Functional Specifications

### 3.1 Application Shell & Navigation

#### 3.1.1 Sidebar Navigation (Collapsible)

**Source**: FE-FR-001

**Description**: A persistent left sidebar providing primary navigation across all application pages. The sidebar has two visual states (collapsed and expanded) and a distinct mobile behavior.

**States and Dimensions**:

| State | Width | Content Displayed | Trigger |
|---|---|---|---|
| Expanded | 240px | Icon + text label for each item | Default on desktop; toggle button |
| Collapsed | 64px | Icon only (centered in 64px) | Toggle button click |
| Mobile Overlay | 280px | Full expanded layout as overlay drawer | Hamburger icon tap in header |

**State Transitions**:

| From | Event | To | Side Effect |
|---|---|---|---|
| Expanded | Click chevron toggle button | Collapsed | Save `sidebar_collapsed=true` to `localStorage` |
| Collapsed | Click chevron toggle button | Expanded | Save `sidebar_collapsed=false` to `localStorage` |
| Mobile Closed | Click hamburger icon in header | Mobile Open (overlay) | Overlay backdrop appears (semi-transparent black) |
| Mobile Open | Click any nav item | Mobile Closed | Navigate to route, close drawer |
| Mobile Open | Click backdrop | Mobile Closed | Drawer closes, no navigation |
| Mobile Open | Press Escape key | Mobile Closed | Drawer closes, no navigation |

**Initial State on Page Load**:
1. Read `sidebar_collapsed` from `localStorage`.
2. If `"true"`, render sidebar in collapsed state.
3. If `"false"` or key does not exist, render sidebar in expanded state.
4. If viewport width < 768px, sidebar is hidden (mobile mode); hamburger icon appears in header.

**Navigation Items (rendered top-to-bottom in this order)**:

| Order | Icon (Lucide) | Label | Route | Badge Content | Badge Condition |
|---|---|---|---|---|---|
| 1 | LayoutDashboard | Dashboard | `/dashboard` | None | N/A |
| 2 | TrendingUp | Trendlines | `/trendlines` | Number (e.g., "12") | Count of active trendlines > 0 |
| 3 | ArrowRightLeft | Execution | `/execution` | Number (e.g., "3") | Count of pending signals > 0 |
| 4 | BookOpen | Journal | `/journal` | None | N/A |
| 5 | Target | Playbooks | `/playbooks` | None | N/A |
| 6 | BarChart3 | Analytics | `/analytics` | None | N/A |
| 7 | MessageSquare | AI Chat | `/chat` | None | N/A |
| 8 | Settings | Settings | `/settings` | None | N/A |

**Badge Behavior**:
- Badge is a small rounded pill positioned to the top-right of the icon (collapsed) or to the right of the label (expanded).
- Badge background: `hsl(217, 91%, 60%)` (primary blue). Badge text: white, `text-xs` (12px).
- When badge count is 0, the badge is hidden entirely (not shown as "0").
- Badge counts are fetched on app mount and updated via WebSocket events on the `trendlines` and `signals` channels.

**Active State**:
- The nav item matching the current route displays: left border accent (4px solid, `--primary` color), background highlight (`--muted` color).
- Active state uses exact route prefix matching: `/settings/brokers` matches the Settings nav item.

**Hover State**:
- Background changes to foreground color at 8% opacity (e.g., `rgba(241, 245, 249, 0.08)` in dark mode).
- Transition duration: 150ms ease.

**Bottom Section**:
- Positioned at the bottom of the sidebar, separated by a `1px` border in `--border` color.
- Contains: User avatar (32px circle, initials fallback if no avatar), display name (truncated at 16 characters with ellipsis in expanded mode, hidden in collapsed mode), subscription plan badge (Free | Trader | Pro), and a Logout button (LogOut icon).
- Clicking the avatar/name opens the same dropdown as the header avatar dropdown.

**Accessibility**:
- Sidebar uses `<nav>` element with `aria-label="Main navigation"`.
- Each nav item is a `<a>` element with proper `href`.
- Active item has `aria-current="page"`.
- Toggle button has `aria-label="Collapse sidebar"` or `"Expand sidebar"` depending on current state.
- Mobile drawer has `role="dialog"`, `aria-modal="true"`, and focus is trapped within the drawer when open.

**Error Handling**:
- If `localStorage` is unavailable (e.g., private browsing in some browsers), default to expanded state. No error shown to the user.
- If badge count API fails, badges are hidden. No error shown to the user; the failure is logged to Sentry.

---

#### 3.1.2 Header Bar

**Source**: FE-FR-002

**Description**: A fixed top header bar spanning the full width of the content area (to the right of the sidebar on desktop, full width on mobile).

**Dimensions**: Height: 56px. Full available width. Position: fixed to top of content area. z-index: 40 (below modals at z-50, above content).

**Background**: `--background` color with a 1px bottom border in `--border` color.

**Layout (left to right)**:

| Position | Component | Details |
|---|---|---|
| Left | Breadcrumb trail | See 3.1.3 |
| Center | Paper/Live mode indicator | See 3.1.4 |
| Right | Command palette trigger | Magnifying glass icon + "Cmd+K" hint text (muted, `text-xs`). On click: opens command palette. |
| Right | Notification bell | Bell icon (Lucide `Bell`). Red dot badge if unread count > 0. On click: opens dropdown. |
| Right | User avatar dropdown | 32px circle avatar. On click: opens dropdown menu. |

**Notification Bell Dropdown**:
- Opens on click as a popover panel, 360px wide, max-height 480px with scroll.
- Header: "Notifications" in `text-sm font-semibold`.
- Lists the 10 most recent notifications, each showing: icon (by type), title (bold), description (muted, truncated at 80 chars), relative timestamp (e.g., "5m ago").
- Unread notifications have a subtle left border in `--primary` color.
- "Mark all as read" link in header (right side). Clicking marks all as read and removes the red badge.
- "View all" link at the bottom navigating to `/settings/notifications`.
- **Empty state**: "No notifications yet." in muted text.
- **Error state**: If notifications fail to load: "Unable to load notifications." with a "Retry" link.

**User Avatar Dropdown**:
- Opens on click as a dropdown menu, 200px wide.
- Items: "Profile" (links to `/settings/profile`), "Settings" (links to `/settings`), separator, "Theme" (sub-menu or toggle with Sun/Moon icons and "Light | Dark | System" options), separator, "Log out" (triggers logout flow).
- Logout: Clears auth cookies, invalidates session via API call, redirects to `/login`.

**Mobile Header (< 768px)**:
- Left: Hamburger icon (Menu) to open sidebar drawer.
- Center: Paper/Live mode indicator (compact: icon only, no text).
- Right: Notification bell and avatar (no command palette trigger on mobile; command palette is still accessible via keyboard shortcut).

---

#### 3.1.3 Breadcrumb Navigation

**Source**: FE-FR-003

**Description**: Breadcrumbs appear in the header for all routes deeper than the top-level navigation items.

**Rendering Rules**:
- Top-level routes (`/dashboard`, `/trendlines`, `/execution`, `/journal`, `/playbooks`, `/analytics`, `/chat`, `/settings`) show NO breadcrumbs; the page title is sufficient.
- Routes with 2+ segments show breadcrumbs.
- Each segment except the last is a clickable `<a>` link styled in `--muted-foreground` color with underline on hover.
- The last segment is plain text in `--foreground` color (not clickable).
- Separator character: `/` in `--muted-foreground` color with `mx-2` spacing.

**Dynamic Segment Formatting**:

| Route Pattern | Breadcrumb Rendering | Example |
|---|---|---|
| `/journal/trade/[id]` | `Journal / Trade #[id]` | `Journal / Trade #47` |
| `/playbooks/[id]` | `Playbooks / [Playbook Name]` | `Playbooks / A+ Trendline Break` |
| `/playbooks/[id]/analytics` | `Playbooks / [Playbook Name] / Analytics` | `Playbooks / A+ Break / Analytics` |
| `/settings/[section]` | `Settings / [Section Label]` | `Settings / Broker Connections` |
| `/playbooks/compare` | `Playbooks / Compare` | `Playbooks / Compare` |

**Truncation**: Playbook names exceeding 24 characters are truncated with an ellipsis. Full name appears in a tooltip on hover.

**Edge Cases**:
- If a trade ID does not exist (404 from API), the breadcrumb still renders as `Trade #[id]` but the page content shows the error state.
- If a playbook is deleted while the user is viewing it, the breadcrumb renders the last known name.

**Accessibility**: Breadcrumbs are wrapped in a `<nav>` element with `aria-label="Breadcrumb"`. The ordered list uses `<ol>` with `<li>` elements. The current page item has `aria-current="page"`.

---

#### 3.1.4 Paper/Live Mode Indicator

**Source**: FE-FR-004

**Description**: A persistent, always-visible badge in the center of the header indicating whether the user is in Paper Trading or Live Trading mode.

**Visual States**:

| Mode | Icon (Lucide) | Text | Background | Text Color | Border |
|---|---|---|---|---|---|
| Paper | TestTube | "PAPER TRADING" | `bg-blue-500/10` | `text-blue-500` | `border-blue-500/20` |
| Live | Zap | "LIVE TRADING" | `bg-green-500/10` | `text-green-500` | `border-green-500/20` |

**Additional Visual Cue**: In Paper mode, a 2px blue (`--mode-paper`) top border spans the full width of the application viewport above the header. In Live mode, no additional border.

**Click Behavior**: Clicking the badge opens the Paper/Live toggle dialog (see 3.4.6).

**Data Source**: The current mode is stored in the Zustand global state store, sourced from the user's profile settings API on app mount.

**Mobile (< 768px)**: The badge displays only the icon (TestTube or Zap) without text, to save horizontal space. The icon retains its color coding.

---

#### 3.1.5 Command Palette

**Source**: FE-FR-005

**Description**: A modal command palette for rapid navigation and search, triggered by keyboard shortcut or button click.

**Trigger**:
- Keyboard: `Cmd+K` (macOS) or `Ctrl+K` (Windows/Linux).
- Click: Command palette trigger button in the header.
- The keyboard shortcut is suppressed when focus is inside a `<input>`, `<textarea>`, or `[contenteditable]` element.

**Appearance**:
- Modal dialog centered on screen, 560px wide, max-height 480px.
- Semi-transparent backdrop (`bg-black/50`).
- Rounded corners (`rounded-lg`), shadow (`shadow-2xl`), background `--popover`.

**Search Input**:
- Auto-focused on open. Placeholder: `"Search pages, instruments, trades..."`.
- Full width, no border, large text (`text-lg`).
- Debounce: Local results (pages, actions) filter instantly (< 16ms). API-backed results (instruments, trades, playbooks) debounce at 200ms.

**Result Categories (displayed as grouped sections with headers)**:

| Category | Source | Max Items | Item Format |
|---|---|---|---|
| Pages | Static list | 8 | Icon + Page name |
| Instruments | Static list (8 MVP instruments) | 8 | Instrument symbol + name + current price + daily change % |
| Recent Trades | API: last 10 trades | 10 | Instrument + direction + P&L (colored) + date |
| Playbooks | API: user playbooks | All | Playbook name + trade count |
| Actions | Static list | 5 | Icon + Action name |

**Actions list**: "New Trade Entry" (navigates to `/execution` and opens trade form), "New Playbook" (navigates to `/playbooks` and opens create form), "Toggle Theme" (switches theme), "Open Settings" (navigates to `/settings`).

**Fuzzy Matching**: As the user types, results filter across all categories. Matching characters in result labels are rendered in bold (`font-semibold`). Matching algorithm: substring match (not Levenshtein) for MVP; the match is case-insensitive.

**Keyboard Navigation**:
- Arrow Up/Down: Move highlight between results.
- Enter: Select highlighted result (navigate or execute action).
- Escape: Close the palette.
- The first result is highlighted by default.

**Performance Requirement**: Local results render within 100ms of keystroke. API results render within 300ms total (200ms debounce + 100ms render).

**Empty State**: If no results match the query: "No results found for '[query]'" in muted text.

**Error Handling**: If the trades or playbooks API call fails, that category section is omitted silently. Pages and Actions (static) always display.

---

#### 3.1.6 Global Loading States

**Source**: FE-FR-006

**Description**: Consistent loading patterns applied across all pages and widgets.

**Page-Level Loading**:
- Display a full-page skeleton layout matching the shape of the page's content areas (card outlines, table row placeholders, chart area rectangles).
- No spinner is used.
- Skeleton elements use a shimmer animation: a left-to-right gradient sweep cycling every 1.5s (`linear`, infinite loop).
- The skeleton must be visible for a minimum of 200ms even if data arrives faster, to prevent a perceptive "flash" of skeleton.
- When `prefers-reduced-motion` is active, skeletons render as static gray blocks without the shimmer animation.

**Widget-Level Loading**:
- Individual widgets within a page load independently via React Suspense boundaries.
- Each widget displays its own skeleton matching its content shape (e.g., 3-row table skeleton for a positions widget, a rectangular area for a chart).

**Background Refetch Loading**:
- When data is being refetched while stale content is already displayed, a thin (2px) progress bar appears at the top of the content area.
- The progress bar uses `--primary` color and animates from left to right (indeterminate style).
- Existing content remains visible and interactive during the refetch.

**Error Boundary Behavior**:
- Every page-level component and every widget-level component is wrapped in a React Error Boundary.
- When an error boundary catches an error:
  1. Display: A card with a red-tinted warning icon, heading "Something went wrong", and a collapsible "Details" section showing the error message (not the stack trace in production).
  2. Action: A "Retry" button that re-renders the component (resetting the error boundary state).
  3. Logging: The error is automatically reported to Sentry with component name, route, user ID, and timestamp.
- One widget failing does NOT crash adjacent widgets or the page shell.

**Empty State Pattern**:
- Each empty state includes: an icon or illustration (from Lucide, 48px), a descriptive heading (`text-lg font-semibold`), a description sentence (`text-sm text-muted-foreground`), and an action CTA button (primary variant).
- Specific empty state content is defined per-widget in section 3.1.7.

---

#### 3.1.7 Toast Notifications

**Source**: FE-FR-007

**Description**: A global toast notification system for transient user feedback.

**Position**: Bottom-right corner of the viewport. 16px margin from screen edges. Toasts stack vertically with an 8px gap between them.

**Toast Types and Styling**:

| Type | Left Border Color | Icon (Lucide) | Auto-Dismiss |
|---|---|---|---|
| `success` | `--profit` (#22C55E) | CheckCircle | 5 seconds |
| `error` | `--loss` (#EF4444) | XCircle | 8 seconds |
| `warning` | `--alert-near` (#EAB308) | AlertTriangle | 5 seconds |
| `info` | `--primary` (#3B82F6) | Info | 5 seconds |

**Toast Content**: Icon (20px) + Title (`font-semibold text-sm`) + optional Description (`text-sm text-muted-foreground`). Maximum 2 lines of text total. If content exceeds 2 lines, it is truncated with an ellipsis.

**Behavior**:
- Auto-dismiss timer starts when the toast appears.
- Hovering over a toast pauses the dismiss timer. Timer resumes on mouse leave.
- Swiping right (touch) or clicking the X button (top-right corner, 16px) dismisses the toast immediately.
- Dismiss animation: toast slides out to the right over 200ms.
- Enter animation: toast slides in from the right over 300ms with spring easing.

**Queue**: Maximum 3 toasts visible simultaneously. If a 4th toast is triggered, it queues and appears when the oldest visible toast dismisses.

**Accessibility**: Toasts are rendered in a `<div>` with `role="status"` and `aria-live="polite"`. Error toasts use `aria-live="assertive"`.

---

### 3.2 Dashboard Home Page

**Route**: `/dashboard`

#### 3.2.1 Today's P&L Summary Card

**Source**: FE-FR-008

**Description**: A prominent full-width card at the top of the dashboard showing the day's profit and loss.

**Layout**: Full width of the content area. Centered content. Padding: `p-6`.

**Content Elements**:

| Element | Typography | Color Logic |
|---|---|---|
| Label: "Today's P&L" | `text-sm text-muted-foreground font-medium` | Always muted |
| Dollar Amount | `text-3xl font-bold font-mono` | Positive: `--profit`. Negative: `--loss`. Zero: `--muted-foreground` |
| Percentage | `text-sm font-mono` | Same color logic as dollar amount |
| Vs. Yesterday | `text-xs text-muted-foreground` | Arrow icon: ArrowUp (green) if better, ArrowDown (red) if worse |

**Formatting Rules**:
- Dollar amounts: Always prefixed with `$` or `-$`. Thousands separator (comma). Two decimal places. Examples: `$1,234.56`, `-$456.78`, `$0.00`.
- Percentage: Prefixed with `+` or `-`. One decimal place. Example: `+2.3%`, `-1.1%`, `0.0%`.
- "Vs. yesterday" comparison: Shows the dollar difference. Example: `ArrowUp +$230 vs. yesterday` or `ArrowDown -$150 vs. yesterday`.

**Paper Mode**: When in Paper mode, the label reads `"Today's P&L (Paper)"` instead of `"Today's P&L"`.

**Data Source**: Real-time via WebSocket on the `account` and `fills` channels. On initial load, fetched from REST API `GET /api/dashboard/pnl?period=today`.

**States**:

| State | Display |
|---|---|
| Loading | Skeleton: one large rectangle (simulating dollar amount) and one small rectangle (simulating percentage) |
| Success (with data) | Full content as described above |
| Success (zero / no trades) | `$0.00` in `--muted-foreground`, percentage `0.0%`, no comparison arrow |
| Error | "Unable to load P&L data." with "Retry" button |

**Edge Cases**:
- If the user has no trades ever (brand new account), display `$0.00` with muted styling and no comparison.
- If yesterday's data is unavailable (first day of trading), the "vs. yesterday" section is hidden.
- On weekends/holidays when markets are closed, display the last trading day's P&L with a note: "Markets closed. Showing last trading day."

---

#### 3.2.2 Active Positions Widget

**Source**: FE-FR-009

**Description**: A card displaying all currently open positions in a compact table.

**Table Columns**:

| Column | Width | Alignment | Format |
|---|---|---|---|
| Instrument | Auto | Left | Symbol text (e.g., "MES") |
| Direction | 80px | Center | Colored chip: "Long" (green bg) or "Short" (red bg) |
| Contracts | 60px | Right | Integer (e.g., "2") |
| Entry Price | 100px | Right | Decimal, `font-mono` (e.g., "5,432.25") |
| Current Price | 100px | Right | Decimal, `font-mono`, updates in real-time |
| Unrealized P&L | 120px | Right | Dollar amount, `font-mono`, green/red coloring |
| % of Account | 80px | Right | Percentage, `font-mono` (e.g., "1.2%") |

**Real-Time Updates**: Current Price and Unrealized P&L columns update via WebSocket on the `positions` channel. Update frequency: 1 Hz (once per second) during market hours. A brief (300ms) background flash animation on the P&L cell indicates a value change (green flash for increase, red flash for decrease).

**Row Click**: Clicking a row navigates to `/execution?position=[id]`, scrolling to and highlighting that position in the full positions table.

**States**:

| State | Display |
|---|---|
| Loading | 3-row skeleton table with shimmer |
| Success (positions exist) | Table with all columns populated |
| Empty | "No open positions" in muted text, centered in the card |
| Error | "Unable to fetch positions. Check broker connection." with "Retry" button |

**Edge Cases**:
- All positions fit without pagination (expected max 5-10 concurrent positions).
- If WebSocket is disconnected, current prices show the last known value with a "stale" indicator (yellow clock icon) and the timestamp of the last update.

---

#### 3.2.3 Active Trendline Alerts Widget

**Source**: FE-FR-010

**Description**: A card showing trendlines currently being monitored for alerts, sorted by quality.

**List Item Layout**: Each item is a horizontal row within the card.

| Element | Format | Position |
|---|---|---|
| Instrument | Text (e.g., "ES") | Left |
| Direction | Icon: TrendingUp for support, TrendingDown for resistance | Left of grade |
| Grade Badge | Filled badge: A+ (gold `#F59E0B`), A (blue `#3B82F6`), B (gray `#6B7280`) | Center-left |
| Touch Count | Text: "3 touches" | Center |
| Alert Status | Badge: see below | Right |

**Alert Status Visual States**:

| Status | Text | Color | Animation |
|---|---|---|---|
| Watching | "Watching" | `--muted-foreground` | None |
| Near Alert | "Near Alert" | `--alert-near` (#EAB308) | Pulse animation (2s ease-in-out infinite) |
| Triggered | "Triggered" | `--alert-triggered` (#22C55E) | Brief flash on transition, then static |

**Sorting**: Default sort by grade descending (A+ first), then by proximity to alert trigger price (closest first).

**Click Behavior**: Clicking a trendline navigates to `/trendlines?instrument=[symbol]&trendline=[id]`. The trendline chart loads with the specified instrument, and the specified trendline is highlighted.

**Maximum Items**: Show top 10 trendlines. If more than 10 exist, a footer link displays: "View all [n] trendlines" linking to `/trendlines`.

**States**:

| State | Display |
|---|---|
| Loading | 5-item skeleton list |
| Success | Sorted list of trendline items |
| Empty | Icon: TrendingUp (48px, muted). Heading: "No active trendlines." Description: "Visit the Trendlines page to scan for setups." CTA: "Scan Trendlines" button linking to `/trendlines`. |
| Error | "Unable to fetch trendlines. Retry." with "Retry" button |

---

#### 3.2.4 Recent Trades Widget

**Source**: FE-FR-011

**Description**: A compact list of the 5 most recent closed trades.

**Each Row**:

| Element | Format | Example |
|---|---|---|
| Date | Relative time (`text-xs text-muted-foreground`) | "2h ago", "Yesterday", "3 days ago" |
| Instrument | Symbol text | "CL" |
| Direction | Text with color: "Long" (green) / "Short" (red) | "Long" |
| P&L | Dollar, `font-mono`, colored | "+$342.00" (green) or "-$198.00" (red) |
| R-Multiple | Number with 1 decimal, `font-mono` | "2.1R" or "-1.0R" |

**Click Behavior**: Clicking a row navigates to `/journal/trade/[id]`.

**Footer**: "View all trades" link to `/journal`.

**States**:

| State | Display |
|---|---|
| Loading | 5-row skeleton list |
| Success | List of trades |
| Empty | "No trades recorded yet." in muted text |
| Error | "Unable to load recent trades. Retry." |

---

#### 3.2.5 Quick Stats Bar

**Source**: FE-FR-012

**Description**: A horizontal row of 4-5 stat cards below the P&L summary.

**Period Selector**: A dropdown above the stats bar with options: Today, This Week, This Month, All Time. Default: "This Month". Selection persists in `localStorage` under key `dashboard_stats_period`.

**Stat Cards**:

| Stat | Format | Example | Sparkline |
|---|---|---|---|
| Win Rate | Percentage + fraction | "68.2% (15/22)" | 30-day trend line |
| Account Equity | Dollar | "$52,340.00" | 30-day trend line |
| Open Risk | Dollar + percentage | "$450 (0.9%)" | No sparkline |
| Total Trades | Integer | "22" | 30-day trend line |
| Avg R-Multiple | Number, 2 decimals | "0.72R" | 30-day trend line |

**Each Card Layout**: Label (`text-xs text-muted-foreground font-medium`), Value (`text-lg font-semibold font-mono`), Sparkline (32px height, `--primary` color, no axis labels) below the value.

**Layout**: Responsive grid. 5 columns on desktop (>1280px), 3 columns on tablet (768-1280px), 2 columns on mobile (<768px).

**States**:

| State | Display |
|---|---|
| Loading | 5 skeleton cards with shimmer |
| Success | Populated stat cards |
| Empty (no trades in period) | All values show "0" or "0.0%" or "$0.00" with muted styling. No sparklines. |
| Error | "Unable to load stats. Retry." in a single card spanning full width |

---

### 3.3 Trendline Detection Page

**Route**: `/trendlines`

#### 3.3.1 Interactive Candlestick Chart

**Source**: FE-FR-013

**Description**: The primary charting area occupying approximately 65% of the page width (left side) on desktop, full width on mobile.

**Chart Engine**: TradingView Lightweight Charts library (v4.x).

**Chart Type**: Candlestick (OHLC). Green candles when close > open. Red candles when close < open.

**Default Configuration**:
- Default timeframe: 4H (primary analysis timeframe per Tori Trades methodology).
- Default instrument: User's configured default instrument from settings, fallback to MES.
- Initial candle count: 300 candles loaded on first render.

**Timeframe Selector**: Horizontal button group positioned above the chart.

| Button | Timeframe | Label |
|---|---|---|
| 1 | 1 Hour | "1H" |
| 2 | 4 Hours | "4H" (highlighted by default) |
| 3 | Daily | "D" |
| 4 | Weekly | "W" |

Active button styling: `--primary` background with white text. Inactive: `--secondary` background with `--foreground` text.

Changing timeframe triggers a full chart data refetch. The trendline list also refreshes for the new timeframe. A loading skeleton replaces the chart during the fetch (not a spinner).

**Interactions**:
- Scroll wheel: Zoom in/out (centered on cursor position).
- Click-drag: Pan left/right through time.
- Double-click: Reset zoom to default view (last 300 candles).
- Pinch-to-zoom: Supported on touch devices.
- Crosshair: Vertical + horizontal dashed lines follow cursor. Price label appears on Y-axis (right), date/time label on X-axis (bottom).

**Axes**:
- Price axis (Y): Right side. Auto-scaling with 10% headroom above the highest visible candle and 10% below the lowest. Formatted with commas and appropriate decimal places for the instrument.
- Time axis (X): Bottom. Format: "Jan 15" for daily/weekly timeframes, "Jan 15 09:00" for intraday (1H/4H).

**Data Source**: REST API via BFF: `GET /api/market-data/{instrument}/{timeframe}?count=300&before={timestamp}`.

**Pagination**: When the user pans left to the beginning of loaded data, a loading indicator appears at the left edge and an additional batch of 300 candles loads. This continues until no more historical data is available.

**States**:

| State | Display |
|---|---|
| Loading | Chart area skeleton with axis placeholders and shimmer |
| Success | Rendered candlestick chart with data |
| Empty | "Select an instrument to view trendlines" centered in chart area |
| Error | "Unable to load chart data." with "Retry" button centered in chart area |

**Edge Cases**:
- If fewer than 300 candles exist for a new instrument, render all available candles.
- If the market is closed, the chart shows the most recent available data. No candles render beyond the last available bar.
- If the API returns an empty dataset (instrument has no data), show empty state.

---

#### 3.3.2 Trendline Overlays

**Source**: FE-FR-014

**Description**: Detected trendlines rendered as line overlays on the candlestick chart.

**Line Rendering**: Each trendline is drawn as a straight line from its first touch point to its last touch point, extended to the right edge of the visible chart area.

**Color Coding by Grade**:

| Grade | Color | Hex | Line Width | Line Style |
|---|---|---|---|---|
| A+ | Gold/amber | `#F59E0B` | 2px | Solid |
| A | Blue | `#3B82F6` | 1.5px | Solid |
| B | Gray | `#6B7280` | 1px | Dashed (4px dash, 4px gap) |

**Touch Point Markers**: Small circles (6px diameter) rendered at each confirmed touch point on the trendline. Circle fill color matches the trendline color. On hover over a touch point: tooltip showing the touch date and price (e.g., "Jan 15, 2026 - $5,432.25").

**Selection Behavior**:
1. User clicks on a trendline.
2. The selected trendline's line width increases to 3px.
3. A glow effect is applied (CSS `filter: drop-shadow(0 0 6px [line-color])` at 50% opacity).
4. The trendline detail panel (3.3.4) populates with this trendline's data.
5. Clicking the chart background (not on a trendline) deselects the current trendline.

**Alert Zone Visualization**: When the current price is within 1x ATR (Average True Range) of a trendline, the area between the trendline and the current price is shaded with a semi-transparent fill (10% opacity of the trendline's color).

**Visibility Toggle**: Each trendline can be toggled visible/hidden via its checkbox in the trendline list panel (3.3.3). Hidden trendlines are not rendered on the chart.

**Performance**: Up to 100 trendlines per instrument must render without frame drops (< 16ms render time per frame).

---

#### 3.3.3 Trendline List Panel

**Source**: FE-FR-015

**Description**: A scrollable list panel on the right side (approximately 35% width on desktop, full width below chart on mobile).

**Tab Bar**: Three tabs at the top of the panel.

| Tab | Content | Default |
|---|---|---|
| Active | Trendlines currently being monitored | Selected by default |
| Triggered | Trendlines whose alerts have fired | |
| Expired | Trendlines no longer valid (broken/aged out) | |

**Each List Item**:

| Element | Format | Position |
|---|---|---|
| Visibility checkbox | Checkbox (checked = visible on chart) | Far left |
| Direction icon | TrendingUp (support) or TrendingDown (resistance) | Left |
| Grade badge | A+ (gold), A (blue), B (gray) filled badge | After icon |
| Touch count | "3 touches" (text-sm) | Center |
| Slope angle | "28 deg" (text-sm, muted) | Center |
| Duration | "5 weeks" (text-sm, muted) | Center |
| Alert status | Watching / Near / Triggered badge | Right |
| Quality score | 0-100 with mini progress bar (32px wide) | Far right |

**Sort Dropdown**: Options: Score (default, descending), Touch Count (descending), Duration (descending), Proximity to Price (ascending, closest first).

**Selection**: Clicking an item highlights the corresponding trendline on the chart and opens the detail panel (3.3.4). The selected item has a `--muted` background highlight.

**Bulk Actions**: A "Dismiss" button appears when one or more items are selected via checkboxes. Dismissing removes the trendline from the active list and sends a `PATCH /api/trendlines/{id}` with `status: "dismissed"` to the backend.

**Empty States**:
- Active tab empty: "No trendlines detected for [instrument]. Adjust parameters or try another instrument."
- Triggered tab empty: "No triggered trendlines yet."
- Expired tab empty: "No expired trendlines."

---

#### 3.3.4 Trendline Detail Panel

**Source**: FE-FR-016

**Description**: A slide-over panel or expanded section that appears when a trendline is selected from the list or clicked on the chart.

**Header**: Instrument symbol + Direction text (Support/Resistance) + Grade badge.

**Metrics Grid (2 columns)**:

| Metric | Format | Example |
|---|---|---|
| Touch Points | Count + expandable list of date/price pairs | "4 touches" → ["Jan 5 - $5,400", "Jan 19 - $5,420", ...] |
| Slope | Degrees + small visual gauge (arc indicator) | "28 deg" |
| Spacing | Average candle count between touches | "18 candles avg" |
| Duration | Timespan from first to last touch | "6 weeks 3 days" |
| Quality Score | 0-100 with color gradient bar (red→yellow→green) | "87 / 100" |
| Current Distance | ATR-normalized | "0.4 ATR" |

**Alert Configuration Section**:
- Enable/disable alert: Toggle switch. Label: "Alert enabled".
- Alert type: Dropdown with options: "Break" (price crosses through trendline), "Touch" (price touches and bounces), "Both".
- Notification channels: Checkboxes for: Dashboard, Telegram, Discord, Email. Default: Dashboard checked, others unchecked.

**Action Buttons**:
- "Set Alert" (primary variant): Saves the alert configuration. On success: toast "Alert set for [Instrument] [Direction] trendline." On failure: toast (error) "Failed to set alert. Please try again."
- "Dismiss" (secondary variant): Confirmation required. Dialog: "Dismiss this trendline?" with "This removes it from your active list. You can find it later in the Expired tab." Confirm button: "Dismiss". Cancel button: "Keep".
- "View Trades" (text link): Only displayed if trades exist that reference this trendline. Links to `/journal?trendline=[id]`.

**History Section**: A collapsible accordion labeled "Alert History". Lists past alert triggers with: date, type (Break/Touch), price at trigger, action taken (Executed/Rejected/Expired). Empty state: "No alert history for this trendline."

---

#### 3.3.5 Instrument Selector

**Source**: FE-FR-017

**Description**: A searchable dropdown for switching between instruments, positioned above the chart.

**Display When Closed**: Shows the currently selected instrument: symbol in bold + full name + current price + daily change percentage (colored green/red).

**Dropdown Content**:
- Search input at top (auto-focused on open). Placeholder: "Search instruments..."
- "Favorites" section (user-pinned instruments, stored in user settings). Each item has a filled star icon.
- "All Instruments" section (alphabetically sorted).

**Supported Instruments (MVP)**:

| Symbol | Full Name |
|---|---|
| ES | E-mini S&P 500 |
| NQ | E-mini Nasdaq 100 |
| CL | Crude Oil |
| GC | Gold |
| PL | Platinum |
| YM | E-mini Dow |
| MES | Micro E-mini S&P 500 |
| MNQ | Micro E-mini Nasdaq 100 |

**Each Item in Dropdown**: Symbol (bold) + Full name + Current price (`font-mono`) + Daily change % (colored green positive, red negative). Star icon (outline for non-favorites, filled for favorites; click star to toggle favorite without closing dropdown).

**On Instrument Change**:
1. Chart re-renders with the new instrument's candle data.
2. Trendline list refreshes for the new instrument.
3. URL updates to `/trendlines?instrument=[symbol]`.
4. The instrument selector closes.

**Keyboard**: Typing while the dropdown is focused filters the instrument list by substring match (case-insensitive).

---

#### 3.3.6 Detection Configuration Panel

**Source**: FE-FR-018

**Description**: A collapsible accordion panel for tuning trendline detection parameters. Located below the trendline list panel or as a separate tab/section.

**Parameters**:

| Parameter | Input Type | Default | Min | Max | Step | Tooltip |
|---|---|---|---|---|---|---|
| Min Touch Count | Slider + number input | 3 | 2 | 5 | 1 | "Minimum pivot points that must intersect the trendline" |
| Min Candle Spacing | Slider + number input | 6 | 3 | 20 | 1 | "Minimum 4H candles between consecutive touches" |
| Max Slope Angle | Slider + number input | 45 | 15 | 75 | 1 | "Maximum angle relative to horizontal (lower = flatter)" |
| Min Duration | Dropdown | "3 weeks" | N/A | N/A | N/A | "Minimum time from first touch to current" |
| Touch Tolerance | Slider + number input | 0.5 | 0.2 | 1.5 | 0.1 | "ATR multiplier for touch proximity (lower = stricter)" |
| Pivot Sensitivity | Slider + number input | 5 | 2 | 10 | 1 | "N-bar lookback for swing point detection" |

Min Duration dropdown options: 1w, 2w, 3w, 1m, 2m, 3m, 6m.

**Validation**:
- Number inputs reject non-numeric characters.
- Values outside the min/max range snap to the nearest valid value on blur.
- Slider and number input are synchronized: changing one updates the other.

**Preset Buttons**:

| Preset | Settings Applied |
|---|---|
| "Tori Trades A+" | Min touches: 3, Spacing: 6, Max slope: 45, Duration: 3w, Tolerance: 0.5, Pivot: 5 |
| "Relaxed" | Min touches: 2, Spacing: 3, Max slope: 75, Duration: 1w, Tolerance: 1.5, Pivot: 3 |
| "Strict" | Min touches: 4, Spacing: 10, Max slope: 30, Duration: 1m, Tolerance: 0.3, Pivot: 7 |

Clicking a preset immediately populates all fields with its values. The "Apply" button must still be clicked to trigger a re-scan.

**Actions**:
- "Apply" button (primary): Sends parameters to `POST /api/trendlines/scan` with the current instrument and parameters. Chart and list reload with new results. Toast on success: "Scan complete. Found [n] trendlines." Toast on error: "Scan failed. Please try again."
- "Reset to Default" button (secondary): Restores all fields to the "Tori Trades A+" preset values.

**Persistence**: Custom settings are saved per-user via `PUT /api/settings/detection-defaults`. On page visit, the last-used settings are loaded from the API.

---

### 3.4 Trade Execution Page

**Route**: `/execution`

#### 3.4.1 Active Positions Table

**Source**: FE-FR-019

**Description**: A full data table of all currently open positions.

**Columns**:

| Column | Description | Sortable | Format |
|---|---|---|---|
| Instrument | Contract symbol | Yes | "MES Mar 26" |
| Direction | Long/Short | Yes | Green chip "Long" / Red chip "Short" |
| Contracts | Position size | Yes | Integer, `font-mono` |
| Entry Price | Fill price | Yes | Decimal, `font-mono` |
| Current Price | Live price | No | Decimal, `font-mono`, WebSocket updated |
| Stop Loss | Stop price | No | Decimal, `font-mono` |
| Take Profit | Target price | No | Decimal, `font-mono` |
| Unrealized P&L | Dollar amount | Yes | `font-mono`, `--profit` or `--loss` color |
| R-Multiple | Current R | Yes | "1.5R" or "-0.3R", `font-mono` |
| Duration | Time since entry | Yes | "2h 15m" or "1d 4h" |
| MAE/MFE | Max adverse/favorable excursion | No | "MAE: 8t / MFE: 24t" (`font-mono`) |

**Default Sort**: By entry time, newest first.

**Real-Time Updates**: Current Price, Unrealized P&L, R-Multiple, and MAE/MFE update via WebSocket on the `positions` channel at 1 Hz during market hours. Value change animation: 300ms background flash (green for favorable change, red for adverse change).

**Row Expand**: Clicking a row expands an inline detail view below the row showing:
- Entry signal source (e.g., "Trendline Engine", "Manual")
- Trendline reference link (if applicable, clickable to `/trendlines?trendline=[id]`)
- Bracket order details: stop order ID, target order ID, order statuses
- Slippage: entry slippage in ticks

**Row Context Menu** (right-click or three-dot icon button at row end):
- "Close Position": Opens a confirmation dialog: "Close [Contracts] [Instrument] [Direction] at market?" with "Close" (destructive variant) and "Cancel" buttons. On confirm: sends `POST /api/positions/{id}/close`. Toast on success: "Position closed. P&L: [amount]". Toast on error: "Failed to close position. [error message]".
- "Modify Stop": Opens an inline edit for the Stop Loss field. Validation: new stop must be valid (below entry for long, above for short). On save: `PATCH /api/positions/{id}` with new stop. Toast on success: "Stop updated to [price]". Toast on error: "Failed to update stop."
- "Modify Target": Same pattern as Modify Stop for the Take Profit field.
- "Flatten All": Closes all open positions. Confirmation dialog: "Close ALL [n] open positions at market? This cannot be undone." On confirm: sends close requests for all positions. Toast: "All positions closed."

**Footer Row**: Sticky bottom row showing totals: Total Unrealized P&L (sum), Total Contracts (sum), Total Open Risk (sum of stop distances in dollars).

**States**:

| State | Display |
|---|---|
| Loading | 3-row skeleton table with shimmer |
| Success | Populated table |
| Empty | "No open positions" centered in table area |
| Error | "Unable to fetch positions. Check broker connection." with "Retry" button |

---

#### 3.4.2 Pending Signals Queue

**Source**: FE-FR-020

**Description**: A section below the positions table showing trade signals awaiting user action.

**Layout**: Card-based layout. Each signal is a distinct card. Cards stack vertically.

**Each Signal Card**:

| Element | Format |
|---|---|
| Source badge | "Trendline Engine" (blue), "TradingView" (purple), "Manual" (gray) |
| Instrument + Direction | Bold text + colored chip |
| Entry Price | `font-mono` decimal |
| Stop Price | `font-mono` decimal, with stop distance in ticks |
| Target Price | `font-mono` decimal, with target distance in ticks |
| Planned R:R | "R:R 2.5:1" |
| Signal Strength / Grade | Grade badge (A+/A/B) if trendline-sourced |
| Age | Relative time since generation: "30s ago", "2m ago" |

**Action Buttons Per Signal**:

1. **"Execute"** (primary button):
   - Click opens a confirmation dialog with full order summary:
     - Instrument, Direction, Contracts, Entry Price, Stop, Target, R:R, Total Risk ($), % of Equity at Risk.
     - If Live mode: bold red warning text: "This will execute a LIVE order with real funds."
     - If Paper mode: blue info text: "This is a paper trade."
   - "Confirm Execute" button (primary in paper mode, destructive variant in live mode).
   - "Cancel" button.
   - On confirm: `POST /api/orders/execute` with signal data. Toast on success: "Order placed. [Instrument] [Direction] [Contracts] contracts." Toast on error: "Order failed: [error message]."

2. **"Reject"** (secondary button):
   - Click opens a small popover with reason dropdown: "Not my setup", "Risk too high", "Already positioned", "Market conditions changed", "Other".
   - "Confirm Reject" button. On confirm: `PATCH /api/signals/{id}` with `status: "rejected"`, `reason: [selected]`. Signal card fades out (200ms). Toast: "Signal rejected."

3. **"Modify"** (icon button, Pencil icon):
   - Opens an inline form within the card allowing the user to adjust entry price, stop price, and target price before execution.
   - Calculated fields (R:R, risk amount) update in real-time as values change.
   - "Save & Execute" button replaces the normal Execute flow.

**Auto-Execution Indicator**: If auto-execution is enabled for this signal type (user setting), the card displays:
- "Auto" badge (green, top-right corner).
- Countdown timer: "Auto-executing in [seconds]s" counting down from the configured delay (default 60s).
- "Cancel Auto" button to prevent auto-execution and keep the signal in pending state.

**States**:

| State | Display |
|---|---|
| Loading | 2 card skeletons |
| Success | Signal cards |
| Empty | "No pending signals. Signals from trendline detection and TradingView webhooks will appear here." |
| Error | "Unable to load signals. Retry." |

---

#### 3.4.3 Manual Trade Entry Form

**Source**: FE-FR-021

**Description**: A form for manually entering trades, accessible via "Add Trade" button in the execution page header or from the pending signals section.

**Form Fields**:

| Field | Type | Required | Default | Validation |
|---|---|---|---|---|
| Instrument | Searchable dropdown | Yes | User's default | Must be a supported instrument |
| Direction | Toggle: Long / Short | Yes | Long | -- |
| Entry Price | Number input | Yes | -- | Positive number, validated to instrument tick size |
| Contracts | Number input | Yes | 1 | Integer, range 1-100 |
| Stop Loss | Number input | Yes | -- | Positive. Long: must be < entry. Short: must be > entry. |
| Take Profit | Number input | No | -- | Positive. Long: must be > entry. Short: must be < entry. |
| Order Type | Dropdown | Yes | Market | Options: Market, Limit |
| Signal Source | Dropdown | Yes | Manual | Options: Manual, TradingView, Other |
| Playbook | Dropdown | No | None | User's playbooks list |
| Notes | Textarea | No | Empty | Max 500 characters, character count shown |

**Validation Error Messages**:

| Condition | Error Message |
|---|---|
| Instrument not selected | "Please select an instrument." |
| Entry Price empty | "Entry price is required." |
| Entry Price non-numeric | "Entry price must be a valid number." |
| Entry Price negative/zero | "Entry price must be greater than zero." |
| Contracts empty | "Number of contracts is required." |
| Contracts not integer | "Contracts must be a whole number." |
| Contracts < 1 or > 100 | "Contracts must be between 1 and 100." |
| Stop Loss empty | "Stop loss is required." |
| Stop Loss invalid for Long | "Stop loss must be below entry price for a long position." |
| Stop Loss invalid for Short | "Stop loss must be above entry price for a short position." |
| Take Profit invalid for Long | "Take profit must be above entry price for a long position." |
| Take Profit invalid for Short | "Take profit must be below entry price for a short position." |
| Notes > 500 chars | "Notes must be 500 characters or fewer." |

**Calculated Fields** (display-only, auto-computed as user fills the form):

| Field | Formula | Format |
|---|---|---|
| Risk per Contract | `|entry - stop| x tick_value` | Dollar, `font-mono` |
| Total Risk | `risk_per_contract x contracts` | Dollar, `font-mono` |
| R:R Ratio | `|entry - target| / |entry - stop|` (if target provided) | "2.5:1" |
| % of Equity at Risk | `total_risk / account_equity x 100` | "1.2%" |

**Risk Rule Violations**: If the entered values violate any configured risk management rule (see 3.8.6), a yellow warning banner appears below the calculated fields listing each violation. Example: "Warning: Total risk ($600) exceeds your max daily loss limit ($500)." The "Place Order" button remains enabled but the confirmation dialog will prominently display the violation.

**Submit Behavior**:
- "Place Order" button. Disabled until all required fields pass validation.
- **Paper mode**: Direct submission. No confirmation dialog. Toast on success: "Paper trade placed. [Instrument] [Direction] [Contracts] contracts at [price]."
- **Live mode**: Confirmation dialog opens. Content: Full order summary table + bold warning: "This will execute a LIVE order. Real funds will be used." + "Place Live Order" button (destructive variant) + "Cancel" button.
- On successful submission: Toast (success). Position appears in the Active Positions table. Form resets to defaults.
- On failure: Toast (error): "Order failed: [error message from API]." Form retains entered values for correction.

---

#### 3.4.4 Broker Connection Status

**Source**: FE-FR-022

**Description**: A persistent status indicator in the Execution page header area.

**States**:

| State | Visual | Text | Action |
|---|---|---|---|
| Connected | Green dot (8px, filled) | "Connected to [Broker Name]" + last heartbeat (e.g., "Last ping: 5s ago") | None |
| Disconnected | Red dot (8px, filled) | "Disconnected from [Broker Name]" | "Reconnect" button |
| Connecting | Yellow dot (8px) with pulse animation | "Connecting..." | None (auto-connecting) |
| Error | Red dot (8px, filled) | Error message (e.g., "Authentication expired") | "Fix" button linking to `/settings/brokers` |
| No Broker | Gray dot (8px, filled) | "No broker connected" | "Connect Broker" button linking to `/settings/brokers` |

**Multiple Brokers**: If multiple brokers are configured, a dropdown lists each broker with its individual status.

**Auto-Reconnect**: When disconnected, the system attempts reconnection every 30 seconds. A countdown is displayed: "Reconnecting in [seconds]s..."

**WebSocket Dependency**: Broker status is received via WebSocket on the `account` channel. If the WebSocket itself is disconnected, the broker status shows "Unknown — WebSocket disconnected" in yellow.

---

#### 3.4.5 Paper/Live Mode Toggle

**Source**: FE-FR-058

**Description**: The dialog for switching between Paper and Live trading modes. Accessible via clicking the header mode indicator or a toggle on the Execution page.

**Toggle UI**: A switch control with "Paper" label on the left and "Live" label on the right. Current mode is visually highlighted.

**Paper to Live Transition** (high-friction by design):

1. User clicks the toggle or the header badge.
2. Confirmation dialog opens: Title: "Switch to Live Trading?"
3. Warning text (red background card): "Orders will be routed to your broker and executed with real funds. You are solely responsible for all trading decisions and outcomes."
4. Checkbox (unchecked by default): "I understand that live orders involve real financial risk."
5. "Switch to Live" button (destructive/red variant). **Disabled** until the checkbox is checked.
6. **60-day paper warning**: If the user has fewer than 60 days of paper trading, an additional yellow warning appears: "You have [X] days of paper trading. We recommend at least 60 days before going live." This is a recommendation, not a blocker.
7. On confirm: API call `POST /api/settings/trading-mode` with `mode: "live"`. On success: toast (warning type): "Switched to Live Trading. All orders will be executed with real funds." The header badge, top border, and all mode-dependent UI elements update. On failure: toast (error): "Failed to switch mode. Please try again."

**Live to Paper Transition** (low-friction):
1. User clicks the toggle or the header badge.
2. No confirmation dialog. The switch happens immediately.
3. API call `POST /api/settings/trading-mode` with `mode: "paper"`.
4. Toast (info): "Switched to Paper Trading."
5. All mode-dependent UI elements update.

**What Must NOT Happen**:
- The mode must NEVER switch without the user explicitly triggering it.
- In Live mode, no action should auto-execute unless the user has both enabled auto-execution AND acknowledged the live mode confirmation.

---

### 3.5 Trade Journal Page

**Route**: `/journal`

#### 3.5.1 Trade Table

**Source**: FE-FR-023

**Description**: The primary view of the journal, a full-featured sortable, filterable, paginated data table of closed trades.

**Columns**:

| Column | Sortable | Filterable | Format |
|---|---|---|---|
| Date | Yes | Date range picker | "Jan 15, 2026 09:30" (`text-sm`) |
| Instrument | Yes | Multi-select dropdown | "MES" |
| Direction | Yes | Toggle filter (Long/Short/All) | Green "Long" / Red "Short" chip |
| Entry Price | Yes | -- | Decimal, `font-mono` |
| Exit Price | Yes | -- | Decimal, `font-mono` |
| P&L ($) | Yes | Range slider | Dollar, `font-mono`, colored |
| P&L (%) | Yes | -- | Percentage, `font-mono`, colored |
| R-Multiple | Yes | Range slider | "2.1R", `font-mono` |
| Playbook | Yes | Multi-select dropdown | Playbook name or "--" |
| Duration | Yes | -- | "2h 15m" |
| Grade | Yes | Multi-select (A+/A/B) | Grade badge |
| Conviction | Yes | Min star filter | Star rating (1-5 filled stars) |
| Tags | No | Tag multi-select | Comma-separated tag badges |

**Default Sort**: Date descending (newest first).

**Pagination**:
- Default: 25 rows per page.
- Page size selector: 10, 25, 50, 100.
- Navigation: First, Previous, page numbers (with ellipsis for large sets), Next, Last.
- Display: "Showing 1-25 of 147 trades" in `text-sm text-muted-foreground`.

**Row Styling**:
- Winning trades (P&L > 0): 2px left border in `--profit` green.
- Losing trades (P&L < 0): 2px left border in `--loss` red.
- Breakeven (within 0.1R of zero): 2px left border in `--breakeven` gray.
- Rows alternate between `--background` and `--card` background for readability.

**Row Click**: Clicking a row navigates to the trade detail view (`/journal/trade/[id]`).

**Bulk Actions**: Checkbox column on the far left. Selecting one or more rows reveals a floating action bar at the bottom:
- "Add to Playbook" (dropdown of playbooks): Assigns selected trades to the chosen playbook.
- "Export Selected (CSV)": Downloads a CSV file of selected trade data.
- "Delete" (destructive): Confirmation dialog: "Delete [n] selected trades? This cannot be undone." On confirm: `DELETE /api/trades/bulk` with trade IDs. Toast: "[n] trades deleted."

**Column Visibility**: A "Columns" dropdown button (top-right of table) allows toggling individual columns on/off. Preference is persisted in `localStorage` under key `journal_visible_columns`.

**States**:

| State | Display |
|---|---|
| Loading | 5-row skeleton table |
| Success | Populated table |
| Empty | Icon: BookOpen (48px, muted). "No trades recorded yet. Add your first trade or connect a broker to start auto-journaling." CTA: "Add Trade" button |
| Error | "Unable to load trades. Retry." |

---

#### 3.5.2 Trade Detail View

**Source**: FE-FR-024

**Description**: A full detail view for a single trade, accessed by clicking a trade row.

**Navigation**: Back button ("< Back to Journal") at top-left. Previous/Next trade navigation arrows at top-right (based on current sort order).

**Layout**: Two columns on desktop (55% left / 45% right). Single column stacked on mobile.

**Left Column (55%)**:

**Mini Chart**: TradingView Lightweight Charts showing the instrument around the trade period.
- Entry point: Green vertical dashed line at entry time.
- Exit point: Purple vertical dashed line at exit time.
- Stop loss: Red horizontal dashed line at stop price.
- Take profit: Green horizontal dashed line at target price.
- Trendline(s): Overlaid if the trade was trendline-sourced (same rendering as 3.3.2).
- Time range: Shows candles from 2 hours before entry to 2 hours after exit (for intraday), or 5 days before/after (for swing trades).

**Screenshot Gallery**: Below the chart. If screenshots are attached:
- Displayed as a horizontal scrollable thumbnail strip (120x80px per thumbnail).
- Click a thumbnail to open a full-screen lightbox with left/right navigation arrows.
- Lightbox closes on backdrop click, X button, or Escape key.
- If no screenshots: Area not rendered (no empty state needed).

**Right Column (45%)**:

**Auto-Captured Data Section** (read-only, rendered as a label-value grid):

| Section | Fields |
|---|---|
| Entry | Date, Time, Price, Order Type, Slippage (ticks) |
| Exit | Date, Time, Price, Order Type, Slippage (ticks) |
| P&L | Dollar (colored), Percentage (colored), R-Multiple |
| Risk | Stop distance (ticks), Risk amount ($), Planned R:R |
| Execution | MAE (ticks + $), MFE (ticks + $), Fill quality score (%) |
| Context | Session (RTH/Overnight), Day of week, Margin type |
| Signal | Source, Trendline grade (if applicable), Touch count, Slope |
| Playbook | Name (clickable link to `/playbooks/[id]`) or "Unassigned" |

**Journal Enrichment Section**: See 3.5.3.

---

#### 3.5.3 Journal Enrichment Form

**Source**: FE-FR-025

**Description**: An inline editable form within the trade detail view for user-provided trade review data.

**Fields**:

| Field | Type | Options / Validation |
|---|---|---|
| Conviction (Pre-Trade) | Star rating 1-5 | Clickable stars. Hover preview: stars highlight up to the hovered position. Click sets value. Click the current value to clear it. |
| Emotional State | Multi-select tag picker | Options: Confident, Anxious, FOMO, Revenge, Patient, Disciplined, Frustrated, Excited, Fearful, Neutral. Max 3 selections. Attempting to select a 4th shows inline error: "Maximum 3 emotional states allowed." |
| Pre-Trade Notes | Rich textarea | Markdown supported. Placeholder: "What was your thesis before entering?" Max 2000 chars. Character counter shows "[current]/2000". |
| Post-Trade Review | Rich textarea | Markdown supported. Placeholder: "What did you learn from this trade?" Max 2000 chars. |
| Mistakes | Multi-select tag picker | Options: Moved Stop, Entered Early, Oversized, Held Too Long, Exited Too Early, Ignored Setup Criteria, FOMO Entry, Revenge Trade, No Stop Loss. No max. |
| Rule Compliance | Checklist | Dynamically generated from the trade's associated playbook rules. Each rule is a checkbox. If no playbook assigned: "Assign a playbook to see rule compliance checklist." |
| Screenshots | File upload | See 3.5.4 |

**Auto-Save Behavior**:
1. Changes are saved automatically 1 second after the user stops typing/clicking (debounced).
2. A save indicator appears near the form header:
   - "Saving..." (muted text with a small spinner icon) during the API call.
   - "Saved" (green text with a checkmark icon) for 2 seconds after successful save.
   - "Save failed. Retrying..." (red text) if the API call fails. Auto-retry after 3 seconds, up to 3 attempts.
   - "Unable to save. Please check your connection." (red text) after 3 failed retry attempts.
3. All fields are optional. Partial saves are valid.

---

#### 3.5.4 Screenshot Upload

**Source**: FE-FR-026

**Description**: A drag-and-drop file upload component within the journal enrichment form.

**Drop Zone**:
- Visual: Dashed border rectangle, `--border` color, `rounded-lg`.
- Content: Upload icon (Lucide `Upload`, 32px) + "Drag screenshots here or click to upload" text.
- On drag-over: Border changes to `--primary` color, background becomes `--primary` at 5% opacity.

**File Constraints**:
- Accepted formats: PNG, JPG, JPEG, WebP.
- Max file size: 5MB per file.
- Max files per trade: 10.

**Upload Flow**:
1. User drops files or clicks to select via file picker.
2. Client-side validation:
   - Wrong format: Toast (error): "Unsupported format. Please use PNG, JPG, or WebP."
   - File too large: Toast (error): "File exceeds 5MB limit. Please reduce the image size."
   - Too many files: Toast (error): "Maximum 10 screenshots per trade. Remove some before adding more."
3. For each valid file:
   a. Request presigned upload URL from `POST /api/uploads/presign` with `{ filename, content_type, trade_id }`.
   b. Upload directly to Cloudflare R2 via the presigned URL (PUT request).
   c. On upload success: Register the file with the trade via `POST /api/trades/{id}/screenshots` with `{ url, filename }`.
4. Progress bar per file (0-100%) shown on the thumbnail during upload.

**Thumbnail Display**: Uploaded images display as a grid of 120x80px thumbnails. Each thumbnail has:
- A delete button (X icon, 16px) in the top-right corner.
- Click delete: Tooltip confirmation "Remove this screenshot?" with "Remove" and "Cancel" buttons. On confirm: `DELETE /api/trades/{id}/screenshots/{screenshot_id}`. Thumbnail fades out.

**Clipboard Paste**: `Cmd+V` / `Ctrl+V` when the upload zone is focused (or anywhere in the trade detail view) pastes a screenshot from the clipboard. The pasted image is treated as a new file upload and follows the same upload flow.

---

#### 3.5.5 Trade Search and Filters

**Source**: FE-FR-027

**Description**: A search bar and filter bar at the top of the trade journal page.

**Full-Text Search**:
- Text input with search icon (Lucide `Search`). Placeholder: "Search trades..."
- Debounce: 300ms. Minimum 2 characters to trigger search.
- Searches across: trade notes, post-trade reviews, instrument names, playbook names, emotional state tags, mistake tags.
- Backend: PostgreSQL `tsvector` full-text search.

**Filter Bar** (horizontal, below search input):

| Filter | Type | Options |
|---|---|---|
| Date Range | Calendar date range picker | Presets: Today, This Week, This Month, Last 30 Days, Last 90 Days, YTD, All Time, Custom |
| Instrument | Multi-select dropdown | All user-traded instruments |
| Playbook | Multi-select dropdown | All user playbooks + "Unassigned" |
| Outcome | Toggle buttons | All, Winners, Losers, Breakeven |
| Direction | Toggle buttons | All, Long, Short |
| Conviction | Star rating filter | Minimum conviction level (1-5) |

**Active Filters Display**: Applied filters appear as removable chips/badges below the filter bar. Each chip shows the filter name and value, with an X button to remove it. "Clear all filters" link appears when any filter is active.

**Results Count**: "Found [n] trades matching your search." displayed above the table when filters or search are active.

**URL Sync**: All filter and search state is reflected in URL query parameters. Examples:
- `/journal?search=crude+oil&instrument=CL&outcome=winners`
- `/journal?date_from=2026-01-01&date_to=2026-01-31&playbook=a-plus-break`
This enables bookmarking and sharing filtered views.

**Edge Cases**:
- No results: Table shows "No trades match your filters." with a "Clear Filters" button.
- Search with < 2 characters: No search is triggered; previous results remain.
- Invalid date range (end before start): Inline error: "End date must be after start date."

---

### 3.6 Playbook Management Page

**Route**: `/playbooks`

#### 3.6.1 Playbook List View

**Source**: FE-FR-028

**Description**: A card grid layout displaying all user playbooks with summary metrics.

**Layout**: 2 columns on desktop (>1280px), 1 column on mobile (<768px). Gap: 16px.

**Each Playbook Card**:

| Element | Format | Position |
|---|---|---|
| Header | Playbook name (`text-lg font-semibold`) + auto-classify badge (if rules configured) | Top |
| System badge | "System" badge (lock icon, muted) for default playbooks | Top-right |
| Metrics row | Win Rate, Expectancy, Trade Count, Profit Factor | Below header, 4 columns |
| Mini equity curve | Sparkline of cumulative P&L, 64px height, `--primary` color | Below metrics |
| Last trade | "Last trade: Jan 15, 2026" in `text-xs text-muted-foreground` | Below sparkline |
| Actions | "View Details" link + three-dot menu (Edit, Delete) | Bottom-right |

**Metrics Row Format**:
- Win Rate: "68.2%"
- Expectancy: "$87/trade"
- Trade Count: "47"
- Profit Factor: "2.14"

Each metric has a label above (`text-xs text-muted-foreground`) and value below (`text-sm font-semibold font-mono`).

**Sort Dropdown**: Top-right of the page. Options: Name (alphabetical), Win Rate (descending), Expectancy (descending), Trade Count (descending), Last Trade Date (newest first). Default: Name.

**System Playbooks**: "A+ Trendline Break", "Standard Trendline Break", "Trendline Bounce" are marked with a "System" badge and a lock icon. They cannot be deleted. They can be edited (name and description only, not classification rules).

**"+ New Playbook" Button**: Prominent button at the top of the page. Opens the playbook form (3.6.3).

**States**:

| State | Display |
|---|---|
| Loading | 3-card skeleton grid |
| Success | Playbook cards |
| Empty | "No playbooks configured. Create your first playbook to start tracking strategy-specific performance." CTA: "Create Playbook" button |
| Error | "Unable to load playbooks. Retry." |

---

#### 3.6.2 Playbook Detail View

**Source**: FE-FR-029, Route: `/playbooks/[id]`

**Description**: A dedicated page for analyzing a single playbook's performance.

**Header**: Playbook name (editable inline: click to edit, Enter to save, Escape to cancel). Description text below. Auto-classification rules summary (e.g., "Auto-classifies: Grade A+ AND Long AND Touch Count >= 3"). "Edit" button (opens form modal) and "Delete" button (with confirmation, see 3.6.3).

**Metrics Section**: Full metric cards in a responsive grid (same layout as analytics metric cards, see 3.7.2), but scoped to this playbook only. Minimum metrics displayed:

| Metric | Format |
|---|---|
| Win Rate, Loss Rate, Breakeven Rate | Percentages |
| Average Winner ($), Average Loser ($) | Dollar amounts |
| Largest Win, Largest Loss | Dollar amounts |
| Profit Factor, Expectancy, Avg R-Multiple | Ratios/dollars |
| Total Trades, Total P&L, Average Duration | Count/dollar/duration |

**Equity Curve**: Full-width line chart showing cumulative P&L over time for this playbook's trades only. Same rendering as the analytics equity curve (3.7.3).

**Trade List**: Embedded trade table (same component as 3.5.1) pre-filtered to this playbook. All sorting and filtering available.

**Time Analysis**: Bar chart showing P&L by month for this playbook. Green bars for profitable months, red for losing months.

**States**:

| State | Display |
|---|---|
| Loading | Skeleton: header + 6 metric card skeletons + chart placeholder + table skeleton |
| Success | Full content |
| Playbook Not Found | "Playbook not found." with "Back to Playbooks" link |
| Error | "Unable to load playbook details. Retry." |

---

#### 3.6.3 Playbook CRUD Forms

**Source**: FE-FR-030

**Description**: A modal/slide-over form for creating and editing playbooks.

**Fields**:

| Field | Type | Required | Validation |
|---|---|---|---|
| Name | Text input | Yes | 2-50 characters. Unique per user. |
| Description | Textarea | No | Max 500 characters. |
| Auto-Classify Rules | Rule builder | No | See below. |
| Target R:R | Number input | No | Range 1.0-10.0, step 0.1 |
| Max Risk Per Trade | Number input (% of equity) | No | Range 0.1-10.0, step 0.1 |

**Validation Error Messages**:

| Condition | Error Message |
|---|---|
| Name empty | "Playbook name is required." |
| Name < 2 chars | "Playbook name must be at least 2 characters." |
| Name > 50 chars | "Playbook name must be 50 characters or fewer." |
| Name not unique | "A playbook with this name already exists." |
| Target R:R out of range | "Target R:R must be between 1.0 and 10.0." |
| Max Risk out of range | "Max risk per trade must be between 0.1% and 10.0%." |

**Auto-Classification Rule Builder**:
- Condition fields presented as a row of dropdowns/inputs:
  - Trendline Grade: dropdown (A+, A, B, Any)
  - Direction: dropdown (Long, Short, Both)
  - Min Touch Count: number input (2-10)
  - Setup Type: dropdown (Break, Bounce, Any)
- Logic: All conditions use AND logic (all must match).
- Preview text renders dynamically below: "Trades will be auto-assigned to this playbook when: Grade is [grade] AND Direction is [direction] AND Touch Count >= [count] AND Setup Type is [type]."

**Create Flow**: POST to `POST /api/playbooks`. On success: toast "Playbook '[name]' created." Modal closes. Playbook list refreshes. On error: toast (error) with API error message.

**Edit Flow**: PUT to `PUT /api/playbooks/{id}`. On success: toast "Playbook updated." On error: toast (error).

**Delete Flow**: Confirmation dialog: "Delete playbook '[name]'? This will not delete the trades, but they will be unassigned from this playbook." Confirm button: "Delete" (destructive). Cancel button: "Cancel". On confirm: `DELETE /api/playbooks/{id}`. Trades' `playbook_id` is set to null on the backend. On success: toast "Playbook '[name]' deleted." Navigate back to `/playbooks`.

**System Playbook Restrictions**: The three system playbooks show the Edit button (for name/description only) but the Delete button is hidden. If a user attempts to delete via API manipulation, the backend returns 403 and the frontend shows: "System playbooks cannot be deleted."

---

#### 3.6.4 Playbook Comparison View

**Source**: FE-FR-031, Route: `/playbooks/compare?ids=[id1],[id2]`

**Description**: A side-by-side comparison of exactly 2 playbooks.

**Selection**: From the playbook list view, each card has a comparison checkbox. When exactly 2 are checked, a "Compare" button appears in a floating action bar. Selecting more than 2 shows: "Select exactly 2 playbooks to compare."

**Layout**: Two equal-width columns. Playbook A on the left, Playbook B on the right.

**Sections Compared**:

1. **Key Metrics Table**: Rows for each metric (Win Rate, Expectancy, Profit Factor, Avg R, Total P&L, Total Trades, Avg Duration, Max Drawdown). Three columns: Metric Name, Playbook A Value, Playbook B Value. The "better" value in each row has a subtle green background highlight. "Better" logic: higher win rate = better, higher expectancy = better, lower max drawdown = better, etc.

2. **Equity Curves**: Both playbooks' equity curves overlaid on the same chart. Playbook A: `--primary` blue line. Playbook B: `#8B5CF6` purple line. Legend at top.

3. **Win Rate Over Time**: Rolling 10-trade window win rate, overlaid line charts, same color coding.

4. **R-Multiple Distributions**: Overlapping histograms (Playbook A bars with 70% opacity, Playbook B bars with 70% opacity, different colors).

**Summary Text**: Auto-generated summary at the top of the page. Example: "Playbook A has a higher win rate (72% vs 58%) but Playbook B has a better expectancy ($145 vs $98 per trade)."

**States**:

| State | Display |
|---|---|
| Loading | Side-by-side skeleton columns |
| Success | Full comparison layout |
| One playbook not found | "One of the selected playbooks was not found." with "Back to Playbooks" link |
| Insufficient data | "Not enough trades to compare. Each playbook needs at least 5 closed trades." |

---

### 3.7 Analytics Dashboard Page

**Route**: `/analytics`

#### 3.7.1 Analytics Filter Bar

**Source**: FE-FR-032

**Description**: A sticky filter bar at the top of the analytics page (stays visible on scroll).

**Filters**:

| Filter | Type | Default | Options |
|---|---|---|---|
| Date Range | Calendar date range picker | Last 90 Days | This Month, Last 30 Days, Last 90 Days, YTD, All Time, Custom |
| Instrument | Multi-select dropdown | All Instruments | All user-traded instruments |
| Playbook | Multi-select dropdown | All Playbooks | All user playbooks |
| Mode | Toggle buttons | Both | Paper, Live, Both |

**Behavior on Filter Change**:
1. All analytics data re-fetches from `GET /api/analytics?date_from=...&date_to=...&instruments=...&playbooks=...&mode=...`.
2. All charts and metrics update simultaneously.
3. A thin progress bar appears at the top of the content area during the refetch.
4. URL query parameters update to reflect current filter state (enabling bookmarking).

**Applied Filters**: Displayed as chips below the filter bar. Each chip has a label and an X button to remove. "Clear all" link appears when any non-default filter is active.

---

#### 3.7.2 Metric Cards Grid

**Source**: FE-FR-033

**Description**: A responsive grid of 27 metric cards organized into 5 groups.

**Layout**: 4 columns on desktop (>1280px), 3 columns on tablet (768-1280px), 2 columns on mobile (<768px). Gap: 16px.

**Card Design**:
- Metric label: `text-xs text-muted-foreground font-medium` (top).
- Metric value: `text-lg font-semibold font-mono` (center).
- Trend indicator: Small arrow icon (ArrowUp or ArrowDown, 12px) + percentage change text (`text-xs`). Green for improvement, red for deterioration. "Improvement" semantics per metric (e.g., higher win rate = improvement, higher max drawdown = deterioration).
- Optional sparkline: 32px height, `--primary` color, no labels.

**Metric Groups and Definitions**:

**Group 1: Trade Performance**

| ID | Metric | Format | Calculation | Improvement = |
|---|---|---|---|---|
| M01 | Win Rate | "68.2%" | Winners / Total Closed | Higher |
| M02 | Loss Rate | "31.8%" | Losers / Total Closed | Lower |
| M03 | Average Winner | "$342" | Mean P&L of winners | Higher |
| M04 | Average Loser | "-$198" | Mean P&L of losers | Lower absolute value |
| M05 | Largest Win | "$1,240" | Max single-trade P&L | Higher |
| M06 | Largest Loss | "-$580" | Min single-trade P&L | Lower absolute value |
| M07 | Profit Factor | "2.14" | Gross Profit / Gross Loss | Higher |
| M08 | Expectancy | "$87/trade" | (Win% x AvgWin) - (Loss% x AvgLoss) | Higher |
| M09 | Total Net P&L | "$4,230" | Sum of all closed P&L | Higher |
| M10 | Total Trades | "47" | Count of closed trades | Neutral (no arrow) |

**Group 2: Risk-Adjusted**

| ID | Metric | Format | Calculation | Improvement = |
|---|---|---|---|---|
| M11 | Sharpe Ratio | "1.82" | Mean return / Std dev (annualized) | Higher |
| M12 | Sortino Ratio | "2.45" | Mean return / Downside deviation | Higher |
| M13 | Calmar Ratio | "3.10" | Annual return / Max drawdown | Higher |
| M14 | Max Drawdown ($) | "$2,340" | Largest peak-to-trough decline | Lower |
| M15 | Max Drawdown (%) | "4.5%" | Max DD as % of peak equity | Lower |
| M16 | Recovery Time | "12 days" | Time from DD trough to new high | Shorter |

**Group 3: R-Multiple Analysis**

| ID | Metric | Format | Improvement = |
|---|---|---|---|
| M17 | Average R | "0.72R" | Higher |
| M18 | Best R | "4.2R" | Higher |
| M19 | Worst R | "-1.0R" | Higher (closer to 0) |
| M20 | R Expectancy | "0.35R" | Higher |

**Group 4: Execution Quality**

| ID | Metric | Format | Improvement = |
|---|---|---|---|
| M21 | Avg Slippage | "0.8 ticks" | Lower |
| M22 | Avg MAE | "12 ticks" | Lower |
| M23 | Avg MFE | "28 ticks" | Higher |
| M24 | Fill Quality | "92%" | Higher |

**Group 5: Behavioral**

| ID | Metric | Format | Improvement = |
|---|---|---|---|
| M25 | Rule Compliance | "85%" | Higher |
| M26 | Cost of Mistakes | "$1,240" | Lower |
| M27 | Avg Conviction | "3.8/5" | Higher |

**States**:

| State | Display |
|---|---|
| Loading | Grid of skeleton metric cards with shimmer |
| Success | Populated metric cards |
| Empty | "Start trading to see your analytics. Paper trades count! Need at least 5 closed trades for meaningful metrics." CTA: "Go to Execution" button |
| Error | "Unable to calculate analytics. Retry." |
| Partial | If some metrics cannot be computed (e.g., no trades with conviction ratings), those cards show "--" as the value |

---

#### 3.7.3 Equity Curve Chart

**Source**: FE-FR-034

**Description**: A full-width line chart showing cumulative P&L over time.

**Axes**:
- X-axis: Time (dates). Auto-scaled to the selected date range in the filter bar.
- Y-axis: Cumulative P&L in dollars. Starting from $0 at the first trade.

**Line**: Smooth curved interpolation with area fill below. Green shaded area above $0 line; red shaded area below $0 line.

**Optional Toggles** (checkboxes above the chart):
- "Show Drawdown": Shaded red areas between the equity curve and its running maximum.
- "Show Break-even": Horizontal dashed line at $0.

**Tooltips**: Hover shows a tooltip card with: Date, Cumulative P&L, Trade count up to that point, Current drawdown %.

**Paper vs. Live**: If "Both" is selected in the mode filter, two separate lines: Paper (blue, `--primary`) and Live (green, `--mode-live`), with a legend.

**Click Interaction**: Clicking a data point on the curve navigates to the trade detail in the journal for the trade that occurred on that date.

**States**:

| State | Display |
|---|---|
| Loading | Chart area skeleton |
| Success | Rendered equity curve |
| Empty (no trades) | Empty chart area with $0 horizontal line and message: "No trade data to display." |
| Error | "Unable to render equity curve. Retry." |

---

#### 3.7.4 P&L Calendar Heatmap

**Source**: FE-FR-035

**Description**: A calendar heatmap visualization showing daily P&L as colored cells.

**Layout**: Monthly grid. One cell per trading day. Weekends and market holidays are grayed out or omitted.

**Color Scale**: Continuous gradient:
- Deep red (`#EF4444` at full saturation): Worst losing day in the visible period.
- White/neutral (`--background`): $0 P&L.
- Deep green (`#22C55E` at full saturation): Best winning day in the visible period.
- Color intensity is proportional to P&L magnitude relative to the min/max of the visible period.

**Cell Content**: Dollar P&L text inside the cell if cell size >= 48px. Otherwise, P&L shown only in tooltip.

**Tooltip on Hover**: Date (full format), Day P&L ($, colored), Trade Count, Win/Loss breakdown (e.g., "3W / 1L").

**Navigation**: Month/year navigation arrows (< and >). Default view: current month with 2 prior months visible (3 months total).

**Click Behavior**: Clicking a cell navigates to `/journal?date_from=[date]&date_to=[date]` (filtering journal to that day).

**Legend**: Horizontal color scale bar at the bottom showing the P&L range (e.g., "-$500" on the red end, "$0" in the center, "+$1,200" on the green end).

**States**:

| State | Display |
|---|---|
| Loading | Calendar grid skeleton |
| Success | Colored heatmap |
| Empty (no trades) | Calendar renders with all cells in neutral color, all values at $0 |
| Error | "Unable to render calendar. Retry." |

---

#### 3.7.5 R-Multiple Distribution Histogram

**Source**: FE-FR-036

**Description**: A bar chart showing how R-multiples are distributed across trades.

**X-axis**: R-multiple buckets in 0.5R increments: ..., -2R to -1.5R, -1.5R to -1R, -1R to -0.5R, -0.5R to 0R, 0R to 0.5R, 0.5R to 1R, ..., 3R to 3.5R, 3.5R+.

**Y-axis**: Trade count.

**Bar Colors**: Red (`--loss`) for negative R buckets. Green (`--profit`) for positive R buckets. Gray (`--breakeven`) for the 0R bucket.

**Reference Lines**:
- Vertical dashed line at 0R (breakeven) in `--muted-foreground`.
- Vertical dashed line at the mean R value, labeled "Avg R: [value]" in `--primary`.

**Annotations**: Text in the chart margin: "Average R: 0.72" and "Median R: 0.45".

**Tooltip on Bar Hover**: R-range (e.g., "1.0R to 1.5R") and exact trade count (e.g., "8 trades").

---

#### 3.7.6 Time-Based Analysis Charts

**Source**: FE-FR-037

**Description**: A section with multiple small charts analyzing performance across time dimensions.

**Charts**:

| Chart | Type | X-axis | Bar Color | Insight Text Example |
|---|---|---|---|---|
| P&L by Day of Week | Horizontal bar | Mon-Fri | Green/red by P&L sign | "Tuesdays are your most profitable day (+$1,240 avg)" |
| P&L by Hour of Day | Vertical bar | 7am-4pm CT (RTH hours) | Green/red | "The 9:30-10:00 hour produces your highest average P&L" |
| P&L by Month | Vertical bar | Calendar months | Green/red | "January was your best month (+$3,200)" |
| Win Rate by Session | Donut chart | RTH vs Overnight segments | Green (RTH) / Blue (Overnight) | "Your RTH win rate (72%) exceeds overnight (54%)" |

Each chart includes a title, the chart itself, and a one-line insight text generated from the data.

---

#### 3.7.7 MAE/MFE Scatter Plots

**Source**: FE-FR-038

**Description**: Two side-by-side scatter plot charts for analyzing execution quality.

**MAE Scatter (Left)**:
- X-axis: MAE (maximum adverse excursion, in ticks).
- Y-axis: Trade P&L ($).
- Each dot: Green for winners, red for losers.
- Reference lines: Horizontal at $0 P&L, Vertical at average MAE.
- Insight: Cluster of losing trades with high MAE suggests stops too wide.

**MFE Scatter (Right)**:
- X-axis: MFE (maximum favorable excursion, in ticks).
- Y-axis: Trade P&L ($).
- Each dot: Green for winners, red for losers.
- Reference line: 45-degree diagonal representing "captured all favorable excursion."
- Insight: Winners with high MFE but low captured P&L suggests exiting too early.

**Both Plots**:
- Tooltip on dot hover: Instrument, Date, P&L, R-Multiple.
- Click a dot: Navigate to the trade detail view in the journal.
- Dot size: 6px diameter. On hover: 10px with transition.

---

#### 3.7.8 Drawdown Chart

**Source**: FE-FR-039

**Description**: A standalone area chart showing drawdown periods and depth.

- X-axis: Time.
- Y-axis: Drawdown percentage (0% at top, negative percentages going down).
- Area fill: Red (`--loss`) with opacity gradient (deeper = more opaque, max 60% opacity).
- Max drawdown annotation: Label at the deepest point showing percentage and date (e.g., "Max DD: -4.5% on Jan 22").
- Recovery periods: Subtle vertical span markers between drawdown start and recovery (return to 0%).
- Tooltip on hover: Date, Drawdown %, Drawdown $ amount, Days in drawdown at that point.

---

### 3.8 Settings Page

**Route**: `/settings`

#### 3.8.1 Settings Navigation

**Source**: FE-FR-040

**Description**: A tabbed or sidebar-within-page layout with multiple settings sections. Each section has its own sub-route.

**Sections**:

| Section | Sub-Route | Icon (Lucide) |
|---|---|---|
| Profile | `/settings/profile` | User |
| Trading Preferences | `/settings/preferences` | SlidersHorizontal |
| Broker Connections | `/settings/brokers` | Link |
| Notifications | `/settings/notifications` | Bell |
| Detection Defaults | `/settings/detection` | TrendingUp |
| Risk Management | `/settings/risk` | Shield |
| Appearance | `/settings/appearance` | Palette |
| Data & Privacy | `/settings/data` | Database |

**Layout**: On desktop (>768px), vertical sidebar on the left (200px) with content on the right. On mobile, horizontal tabs at the top (scrollable).

---

#### 3.8.2 Profile Management

**Source**: FE-FR-041

**Fields**:
- Display name: Text input, 2-50 chars. Save on blur.
- Email: Read-only if using OAuth. Editable with verification flow if using email auth.
- Avatar: Upload component (click to select, 2MB max, PNG/JPG). Circular crop preview.
- Timezone: Dropdown with auto-detect option. 400+ timezone options grouped by region.

**Account Info (read-only)**:
- Subscription tier badge (Free/Trader/Pro).
- Member since: Date.
- Usage stats: Trades this month, API calls this month.

**Actions**:
- "Change Password": Opens a form with current password, new password, confirm password. Validation: new password >= 8 chars, 1 uppercase, 1 number. Must not match current.
- "Delete Account": Opens a two-step confirmation. Step 1: "Are you sure? This will permanently delete all your data." Step 2: "Type 'DELETE' to confirm." Input must exactly match "DELETE" (case-sensitive). Before deletion, prompt: "Would you like to export your data first?" with "Export Data" button. On confirm: `DELETE /api/account`. Redirect to landing page.

---

#### 3.8.3 Trading Preferences

**Source**: FE-FR-042

| Preference | Type | Default | Options/Validation |
|---|---|---|---|
| Default Instrument | Dropdown | MES | All supported instruments |
| Default Timeframe | Dropdown | 4H | 1H, 4H, D, W |
| Default Order Type | Dropdown | Market | Market, Limit |
| Slippage Assumption (Paper) | Number (ticks) | 1 | Range 0-10, integer |
| Auto-Execute Signals | Toggle | Off | On/Off |
| Auto-Execute Delay | Number (seconds) | 60 | Range 10-300, integer. Only editable when Auto-Execute is On |
| Currency Display | Dropdown | USD | USD (only option for MVP) |

**Save Behavior**: Auto-save on change. Toast: "Preference updated." No explicit save button.

---

#### 3.8.4 Broker Connection Management

**Source**: FE-FR-043

**Connection Card** (for each configured broker):
- Broker logo (40px) + name.
- Status: Connected (green dot), Disconnected (red dot), Error (yellow dot with message).
- Account ID: Masked, last 4 digits visible (e.g., "****4521").
- Last sync: Relative timestamp.
- Actions: "Test Connection" (button), "Reconnect" (button, shown when disconnected), "Remove" (button, destructive).

**Test Connection**: Sends `POST /api/brokers/{id}/test`. During test: button shows spinner + "Testing..." On success: green checkmark + "Connection successful." On failure: red X + specific error message (e.g., "Authentication failed. Please re-enter credentials.", "Connection timed out. Check that IB Gateway is running.").

**Remove Broker**: Confirmation dialog: "Remove [Broker Name] connection? You will need to re-enter credentials to reconnect." On confirm: `DELETE /api/brokers/{id}`. Toast: "Broker connection removed."

**Add Broker Flow**:

Step 1 - Select broker:
- Card options: IBKR, Tradovate, Webull. Each card shows broker logo, name, supported features list, commission info.

Step 2 - Enter credentials (varies by broker):

| Broker | Fields |
|---|---|
| IBKR | Host (text, default "127.0.0.1"), Port (number, default 7497), Client ID (number), Account ID (text). Help link: "How to set up IB Gateway" |
| Tradovate | Username (text), Password (password), App ID (text), App Version (text). Help link: "Tradovate API setup guide" |
| Webull | App Key (text), App Secret (password). Help link: "Webull API setup guide" |

Step 3 - Test connection: Automatic test on submit. Show success/failure with specific error messages.

Step 4 - Confirm and save: "Connection successful! Save this broker?" with "Save" button. Connection appears in the list.

**Security Note**: Displayed prominently: "Credentials are encrypted at rest and never stored in plain text."

---

#### 3.8.5 Notification Preferences

**Source**: FE-FR-044

**Grid Layout**: Rows = notification types, Columns = channels (Dashboard, Telegram, Discord, Email).

| Notification Type | Dashboard | Telegram | Discord | Email |
|---|---|---|---|---|
| Trendline Break Alert | Toggle | Toggle | Toggle | Toggle |
| Trendline Touch Alert | Toggle | Toggle | Toggle | Toggle |
| New A+ Trendline | Toggle | Toggle | Toggle | Toggle |
| Trade Filled | Toggle | Toggle | Toggle | Toggle |
| Trade Closed | Toggle | Toggle | Toggle | Toggle |
| Daily P&L Summary | Toggle | -- | -- | Toggle |
| Weekly Performance Report | -- | -- | -- | Toggle |
| System Alerts | Toggle | Toggle | -- | Toggle |

**Defaults**: All Dashboard toggles ON. All external channel toggles OFF.

**Channel Setup**:
- Telegram: "Configure" button opens a setup card with: link to TrendEdge Telegram bot, text input for Chat ID, "Test" button that sends a test message. Success: "Test message sent! Check your Telegram." Failure: "Unable to send test message. Verify your Chat ID."
- Discord: "Configure" button opens a setup card with: webhook URL input. "Test" button. Same success/failure pattern.

**Quiet Hours**: Toggle with time range picker. Default: 10:00 PM - 7:00 AM (user's timezone). When active, all notifications except System Alerts are suppressed during quiet hours.

**Save**: Auto-save on each toggle change. Toast: "Notification preferences updated."

---

#### 3.8.6 Risk Management Rules

**Source**: FE-FR-046

| Rule | Type | Default | Range | Description |
|---|---|---|---|---|
| Max Position Size | Number (contracts) | 5 | 1-100 | Maximum contracts per order |
| Max Daily Loss | Dollar amount | $500 | $50-$50,000 | Trading halts when daily loss exceeds this |
| Max Concurrent Positions | Number | 3 | 1-20 | Maximum open positions at once |
| Min R:R Ratio | Number | 2.0 | 0.5-10.0 | Orders below this R:R are rejected |
| Max % Equity at Risk | Percentage | 2% | 0.1%-10% | Max risk per trade as % of equity |
| Correlation Limit | Number | 2 | 1-10 | Max positions in correlated instruments |

**Enforcement Behavior**: When a trade would violate a rule:
1. The trade is blocked in the pending signals queue.
2. A yellow warning banner appears on the signal card: "Blocked: [Rule Name] - [specific message]."
   - Example: "Blocked: Max Daily Loss - Daily loss ($480) would exceed $500 limit with this trade."
   - Example: "Blocked: Max Concurrent Positions - You already have 3 open positions."
3. The user can override with an "Override for this trade" button. Clicking it logs a warning entry to the audit log and allows the trade to proceed.

**Save**: Auto-save on change. Toast: "Risk rule updated."

---

### 3.9 AI Chat Interface

**Route**: `/chat`

#### 3.9.1 Conversational Analytics Chat

**Source**: FE-FR-049

**Description**: A chat interface for natural language queries against the user's trading data.

**Layout**: Full page height minus header (56px). Chat messages in a scrollable container. Input area fixed at the bottom.

**Message Types**:

| Type | Alignment | Styling |
|---|---|---|
| User message | Right-aligned | Blue background (`--primary` at 20%), rounded corners, max-width 80% |
| Assistant message | Left-aligned | Card-style with `--card` background, rounded corners, max-width 90% |

**Assistant Message Content Types**:
- Plain text: Rendered with markdown formatting (bold, italic, lists, code blocks).
- Inline metric cards: Small card components matching the analytics metric card design.
- Embedded charts: Rendered using the same chart components as the analytics dashboard (equity curves, bar charts, etc.).
- Trade lists: Clickable links to trade detail views.
- Tables: Styled data tables for tabular responses.

**Input Area**:
- Textarea: Auto-growing from 1 line to max 4 visible lines. Scrollable beyond 4 lines.
- Send button: Arrow icon (Lucide `ArrowUp`), circular, `--primary` background. Disabled (grayed out) while awaiting a response or when input is empty.
- Keyboard: Enter to send, Shift+Enter for new line.

**Suggested Prompts** (shown on empty chat):
A 2x3 grid of clickable prompt cards:
1. "What is my win rate by day of week?"
2. "Show my best and worst trades this month."
3. "Compare my trendline break vs. bounce performance."
4. "How much have my mistakes cost me?"
5. "What is my average R-multiple on A+ setups?"

Clicking a suggested prompt fills the input and immediately sends it.

**Streaming**: Assistant responses stream token-by-token. Text appears incrementally. Charts and metric cards render once their data is fully received (not streamed).

**Conversation History**: Chat history persists within the current session (Zustand store). "New Chat" button (top-right) clears the conversation history.

**States**:

| State | Display |
|---|---|
| Initial (empty chat) | Suggested prompts grid |
| Waiting for response | User message displayed. Below it: 3 bouncing dots animation (typing indicator). Send button disabled. |
| Response streaming | Tokens appearing incrementally in assistant message bubble |
| Error | Assistant message: "I couldn't find enough data to answer that question. Try being more specific or adjusting the date range." |
| AI Service Unavailable | Assistant message: "AI service unavailable. Please try again in a few minutes." |

**Context Awareness**: The AI has access to the authenticated user's trade data, playbooks, and analytics only. It does NOT have access to other users' data.

**What Must NOT Happen**:
- The chat must NEVER display or reference another user's trading data.
- The chat must NEVER execute trades. It is read-only analytics.
- The chat must NEVER display raw API keys, tokens, or credentials.

---

### 3.10 Onboarding Flow (Phase 3)

**Route**: `/onboarding`

#### 3.10.1 Welcome Wizard

**Source**: FE-FR-047

**Description**: A multi-step guided setup for new users.

**Step Indicator**: Horizontal progress bar at the top showing current step (filled circles) and remaining steps (outline circles). Labels below each circle.

**Steps**:

**Step 1: Welcome**
- TrendEdge logo (centered, 64px).
- Tagline: "AI-powered futures trading, from detection to journal."
- "Get Started" button (primary, large).
- "Skip Setup" text link below: navigates to `/dashboard` with empty state guidance active.

**Step 2: Trading Profile**
- Experience level: Radio buttons: Beginner / Intermediate / Advanced. Affects default detection parameter strictness.
- Primary instruments: Checkbox grid of 8 supported instruments. At least 1 required. Validation: "Select at least one instrument."
- Trading style: Radio buttons: "Trendline Swing" (default), "Systematic/Algo", "Manual Discretionary".
- Timezone: Auto-detected from browser, editable dropdown.
- "Continue" button. "Back" button.

**Step 3: Broker Connection (Optional)**
- Same UI as the Add Broker flow (3.8.4) but embedded.
- "Skip for now" link with note: "You can connect a broker anytime from Settings."
- "Continue" button after successful connection or skip.

**Step 4: First Playbook**
- If "Trendline Swing" was selected: Pre-populate with "A+ Trendline Break" playbook fields.
- Brief explanation card: "Playbooks track the performance of each trading strategy separately."
- "Create" button or "Use Default Playbooks" button (creates all 3 system playbooks).

**Step 5: Paper Trading Activation**
- Explanation text: "Paper trading lets you test the full system risk-free before going live."
- "Start Paper Trading" button (primary). Activates paper mode.
- Note: "We recommend at least 60 days of paper trading before going live."

**Step 6: Complete**
- Checkmark icon (green, 64px). "You're all set!"
- Summary card listing: configured instruments, connected broker (if any), created playbook(s), mode (Paper).
- "Go to Dashboard" button (primary).

**Tracking**: Onboarding completion status stored in user profile. Users who haven't completed onboarding see a banner on the dashboard: "Finish your setup" with a "Resume" link to the wizard at the last incomplete step.

**Skip Behavior**: Skipping any step applies sensible defaults. All settings are editable later from the Settings page.

---

### 3.11 Landing Page (Phase 3)

**Route**: `/` (unauthenticated users only)

#### 3.11.1 Marketing Landing Page

**Source**: FE-FR-048

**Sections** (scrolling single page):

1. **Hero**: Headline + subheadline + "Start Free" CTA button + dashboard screenshot/demo.
2. **Problem Statement**: "Tired of switching between 3-4 tools?" with icon grid.
3. **Feature Sections**: Detection, Execution, Journaling, Analytics (each with screenshot + description).
4. **Comparison Table**: TrendEdge vs. competitors.
5. **Pricing**: Tier cards (Free, Trader, Pro, Team) with feature comparison.
6. **Social Proof**: Testimonials/quotes.
7. **Footer**: Docs, support, privacy, terms links.

**Performance**: Lighthouse performance score > 95. Static content. No client-side data fetching. ISR for pricing if dynamic.

**SEO**: Meta tags, Open Graph tags, structured data (SoftwareApplication schema). Target keywords: "futures trading journal", "trendline detection", "automated futures trading".

---

### 3.12 Real-Time Updates

#### 3.12.1 WebSocket Integration

**Source**: FE-FR-050

**Connection Lifecycle**:
1. WebSocket connection established on app mount (after authentication).
2. Auth token passed as a query parameter: `wss://api.trendedge.com/ws?token=[jwt]`.
3. Server validates the token before accepting the connection.
4. On disconnect: automatic reconnection with exponential backoff: 1s, 2s, 4s, 8s, 16s, max 30s.

**Connection Status Indicator**: Small dot in the header, visible only on hover or when NOT connected.

| Status | Dot Color | Animation |
|---|---|---|
| Connected | Green | None |
| Reconnecting | Yellow | Pulse |
| Disconnected | Red | None |

**Subscribed Channels and UI Effects**:

| Channel | Event | UI Update |
|---|---|---|
| `positions` | Position opened/closed/updated | Active positions table (dashboard + execution), P&L card |
| `fills` | Order filled | Toast notification, position update, journal entry auto-created |
| `trendlines` | New trendline detected / alert triggered | Trendline list, dashboard widget, chart overlay |
| `signals` | New signal generated | Pending signals queue, notification badge on sidebar |
| `account` | Balance/margin update | Dashboard equity stat, account info |
| `alerts` | Notification dispatched | Notification bell badge increment, toast |

**Optimistic Reconciliation**: When a WebSocket message conflicts with a pending optimistic update (e.g., user edited a journal entry but server returns a different value), the server data takes precedence. The UI updates to match server state.

**Stale Data Detection**: If the WebSocket disconnects for > 60 seconds, on reconnection the client performs a full data refresh for all currently visible widgets by invalidating all TanStack Query caches.

---

### 3.13 Responsive Design

#### 3.13.1 Breakpoints

**Source**: FE-FR-051

| Breakpoint | Width | Name | Layout Notes |
|---|---|---|---|
| Mobile | < 768px | `sm` | Single column, drawer nav, stacked cards, bottom tab bar |
| Tablet | 768-1279px | `md` | Two columns, collapsible sidebar, responsive charts |
| Desktop | 1280-1535px | `lg` | Three columns where applicable, expanded sidebar |
| Wide | >= 1536px | `xl` | Full layout, maximum chart area |

**Mobile Navigation**: Bottom tab bar replacing sidebar. Tabs: Dashboard, Trendlines, Journal, More (dropdown with: Execution, Playbooks, Analytics, Chat, Settings).

**Tables on Mobile**: Horizontal scroll with fixed first column (instrument name). Alternatively, card-based layout replacing table rows (trade table renders as trade cards on mobile).

**Charts on Mobile**: Full width. Touch interactions (pinch-zoom, pan). Detail panels stack below charts.

**Touch Targets**: All interactive elements have minimum 44px touch target size on mobile.

---

### 3.14 Theme System

#### 3.14.1 Dark/Light Mode

**Source**: FE-FR-052

**Default**: Dark mode.

**Three-State Toggle**: Light | Dark | System. Available in header user dropdown and Settings > Appearance.

**Resolution Order** (on initial page load):
1. Check cookie `theme` (set during SSR to prevent flash).
2. Check `localStorage` key `theme`.
3. Check `prefers-color-scheme` OS media query.
4. Default to `dark`.

**Transition**: 200ms CSS transition on `background-color` and `color` properties on theme switch.

**SSR Flash Prevention**: Theme cookie is read server-side so Next.js renders the correct theme class on the `<html>` element during SSR. No white flash on dark-mode clients.

**Dark Theme Colors**: See Section 6 (UI/UX Specifications) for full color token definitions.

**Light Theme Colors**: Inverted background/foreground. Trading semantic colors (green profit, red loss) remain the same in both themes.

---

### 3.15 Keyboard Shortcuts

#### 3.15.1 Global Shortcuts

**Source**: FE-FR-053

| Shortcut | Action | Context |
|---|---|---|
| `Cmd+K` / `Ctrl+K` | Open command palette | Global |
| `Cmd+/` / `Ctrl+/` | Show keyboard shortcuts help dialog | Global |
| `G` then `D` | Navigate to Dashboard | Global (vim-style sequence, 500ms timeout between keys) |
| `G` then `T` | Navigate to Trendlines | Global |
| `G` then `E` | Navigate to Execution | Global |
| `G` then `J` | Navigate to Journal | Global |
| `G` then `P` | Navigate to Playbooks | Global |
| `G` then `A` | Navigate to Analytics | Global |
| `G` then `C` | Navigate to AI Chat | Global |
| `G` then `S` | Navigate to Settings | Global |
| `N` | New trade entry (opens form) | Journal, Execution pages only |
| `Escape` | Close modal/panel/palette | Global |
| `[` / `]` | Previous / Next item | Trade detail view |
| `F` | Toggle favorite instrument | Trendlines page |
| `?` | Show contextual help | Global |

**Suppression**: All shortcuts are suppressed when focus is in a `<input>`, `<textarea>`, or `[contenteditable]` element. This prevents interference with typing.

**Help Dialog**: `Cmd+/` opens a modal listing all shortcuts grouped by context (Global, Navigation, Trade Detail, Trendlines). The modal has sections with shortcut key badges and descriptions.

---

### 3.16 Accessibility

#### 3.16.1 WCAG 2.1 AA Compliance

**Source**: FE-FR-054

**Color Contrast**: All text meets 4.5:1 ratio (normal text) and 3:1 (large text) in both themes. Green/red chart colors are supplemented with patterns or shapes (filled vs. hollow circles, solid vs. dashed lines) for color-blind users.

**Keyboard Navigation**: All interactive elements reachable via Tab. Focus order matches visual order. Visible focus indicators: 2px ring in `--primary` color.

**Screen Reader Support**: All images have `alt` text. Charts have `aria-label` describing data trends. Tables use `<th>` with `scope`. Dynamic content updates use `aria-live` regions.

**Reduced Motion**: When `prefers-reduced-motion` is set, all animations are disabled (skeleton shimmer, chart draw, alert pulse, toast slide, modal transitions all render instantly).

**Form Accessibility**: All inputs have `<label>` elements. Error messages linked via `aria-describedby`. Required fields marked with `aria-required="true"`.

**Skip Navigation**: "Skip to main content" link as the first focusable element on every page.

**Semantic HTML**: `<nav>`, `<main>`, `<aside>`, `<section>`, `<article>`, proper heading hierarchy (`h1` through `h6`).

---

## 4. Data Specifications

### 4.1 Client-Side Data Models

All TypeScript types are generated from the FastAPI backend's OpenAPI spec using `openapi-typescript`. The following are the key frontend-facing interfaces.

#### 4.1.1 Trade

```typescript
interface Trade {
  id: string;                    // UUID
  user_id: string;               // UUID
  instrument: string;            // e.g., "MES"
  direction: "long" | "short";
  entry_price: number;           // Decimal
  exit_price: number | null;     // Null if still open
  contracts: number;             // Integer, 1-100
  stop_loss: number;
  take_profit: number | null;
  entry_time: string;            // ISO 8601
  exit_time: string | null;
  pnl_dollars: number | null;    // Null if open
  pnl_percent: number | null;
  r_multiple: number | null;
  mae_ticks: number | null;      // Max adverse excursion
  mfe_ticks: number | null;      // Max favorable excursion
  slippage_entry: number | null; // Ticks
  slippage_exit: number | null;
  signal_source: "trendline_engine" | "tradingview" | "manual" | "other";
  trendline_id: string | null;   // UUID reference
  playbook_id: string | null;    // UUID reference
  order_type: "market" | "limit";
  session: "rth" | "overnight";
  status: "open" | "closed" | "cancelled";
  mode: "paper" | "live";
  // Journal enrichment fields
  conviction: number | null;      // 1-5
  emotional_states: string[];     // Max 3
  pre_trade_notes: string | null; // Max 2000 chars
  post_trade_review: string | null;
  mistakes: string[];
  rule_compliance: Record<string, boolean>; // Rule name -> checked
  screenshots: Screenshot[];
  created_at: string;
  updated_at: string;
}
```

#### 4.1.2 Position

```typescript
interface Position {
  id: string;
  instrument: string;
  direction: "long" | "short";
  contracts: number;
  entry_price: number;
  current_price: number;         // Updated via WebSocket
  stop_loss: number;
  take_profit: number | null;
  unrealized_pnl: number;       // Updated via WebSocket
  r_multiple: number;
  mae_ticks: number;
  mfe_ticks: number;
  entry_time: string;
  signal_source: string;
  trendline_id: string | null;
  mode: "paper" | "live";
}
```

#### 4.1.3 Trendline

```typescript
interface Trendline {
  id: string;
  instrument: string;
  direction: "support" | "resistance";
  grade: "A+" | "A" | "B";
  touch_count: number;
  touch_points: TouchPoint[];
  slope_degrees: number;
  spacing_candles: number;       // Avg candle count between touches
  duration_days: number;
  quality_score: number;         // 0-100
  current_distance_atr: number;  // ATR-normalized distance
  alert_status: "watching" | "near" | "triggered" | "dismissed" | "expired";
  alert_enabled: boolean;
  alert_type: "break" | "touch" | "both" | null;
  notification_channels: string[];
  status: "active" | "triggered" | "expired" | "dismissed";
  created_at: string;
}

interface TouchPoint {
  date: string;     // ISO 8601
  price: number;
}
```

#### 4.1.4 Playbook

```typescript
interface Playbook {
  id: string;
  user_id: string;
  name: string;                  // 2-50 chars
  description: string | null;    // Max 500 chars
  is_system: boolean;            // True for default playbooks
  auto_classify_rules: ClassifyRules | null;
  target_rr: number | null;      // 1.0-10.0
  max_risk_percent: number | null; // 0.1-10.0
  metrics: PlaybookMetrics;
  created_at: string;
  updated_at: string;
}

interface ClassifyRules {
  trendline_grade: "A+" | "A" | "B" | "any";
  direction: "long" | "short" | "both";
  min_touch_count: number;
  setup_type: "break" | "bounce" | "any";
}

interface PlaybookMetrics {
  win_rate: number;
  loss_rate: number;
  expectancy: number;
  profit_factor: number;
  trade_count: number;
  total_pnl: number;
  avg_r_multiple: number;
}
```

#### 4.1.5 Signal

```typescript
interface Signal {
  id: string;
  source: "trendline_engine" | "tradingview" | "manual";
  instrument: string;
  direction: "long" | "short";
  entry_price: number;
  stop_price: number;
  target_price: number;
  planned_rr: number;
  trendline_grade: string | null;
  status: "pending" | "executed" | "rejected" | "expired";
  rejection_reason: string | null;
  auto_execute: boolean;
  auto_execute_at: string | null; // ISO 8601 timestamp
  created_at: string;
}
```

#### 4.1.6 Notification

```typescript
interface Notification {
  id: string;
  type: "trendline_break" | "trendline_touch" | "new_a_plus" | "trade_filled" | "trade_closed" | "daily_summary" | "weekly_report" | "system_alert";
  title: string;
  description: string;
  read: boolean;
  created_at: string;
  action_url: string | null;     // URL to navigate to on click
}
```

#### 4.1.7 Screenshot

```typescript
interface Screenshot {
  id: string;
  trade_id: string;
  url: string;                   // Cloudflare R2 URL
  filename: string;
  uploaded_at: string;
}
```

### 4.2 Client-Side State Management (Zustand Stores)

| Store | State | Persisted |
|---|---|---|
| `useAuthStore` | `user`, `isAuthenticated`, `mode` (paper/live) | Cookie (server-side) |
| `useUIStore` | `sidebarCollapsed`, `theme`, `dashboardStatsPeriod` | localStorage |
| `usePositionsStore` | `positions[]`, `lastUpdate` | No (WebSocket-driven) |
| `useTrendlineStore` | `selectedInstrument`, `selectedTrendline`, `detectionParams` | URL params + API |
| `useChatStore` | `messages[]`, `isStreaming` | Session only (memory) |
| `useNotificationStore` | `notifications[]`, `unreadCount` | No (API-driven) |

### 4.3 API Response Envelope

All REST API responses follow this format:

```typescript
interface ApiResponse<T> {
  data: T;
  meta?: {
    page?: number;
    page_size?: number;
    total?: number;
    total_pages?: number;
    cursor?: string;  // For cursor-based pagination
  };
  error?: {
    code: string;      // Machine-readable error code
    message: string;   // Human-readable error message
    details?: Record<string, string[]>; // Field-level validation errors
  };
}
```

### 4.4 Data Validation Rules Summary

| Entity | Field | Rule |
|---|---|---|
| Trade (manual entry) | instrument | Required, must be in supported list |
| Trade | entry_price | Required, positive number, tick-size validated |
| Trade | contracts | Required, integer, 1-100 |
| Trade | stop_loss | Required, positive, directionally valid |
| Trade | take_profit | Optional, positive, directionally valid |
| Trade | notes | Optional, max 500 chars |
| Journal Enrichment | conviction | Optional, integer 1-5 |
| Journal Enrichment | emotional_states | Optional, max 3 selections |
| Journal Enrichment | pre_trade_notes | Optional, max 2000 chars |
| Journal Enrichment | post_trade_review | Optional, max 2000 chars |
| Playbook | name | Required, 2-50 chars, unique per user |
| Playbook | description | Optional, max 500 chars |
| Playbook | target_rr | Optional, 1.0-10.0 |
| Playbook | max_risk_percent | Optional, 0.1-10.0 |
| Screenshot | file_type | PNG, JPG, JPEG, WebP only |
| Screenshot | file_size | Max 5MB |
| Screenshot | count_per_trade | Max 10 |
| Profile | display_name | 2-50 chars |
| Profile | password (change) | Min 8 chars, 1 uppercase, 1 number |
| Risk Rule | max_position_size | 1-100 |
| Risk Rule | max_daily_loss | $50-$50,000 |
| Risk Rule | max_concurrent_positions | 1-20 |

---

## 5. API Specifications

### 5.1 API Communication Pattern

The frontend communicates with the FastAPI backend exclusively through Next.js API routes (BFF pattern). The browser never calls the FastAPI backend directly.

```
Browser --> GET /api/dashboard/pnl --> Next.js API Route --> GET {BACKEND_URL}/v1/dashboard/pnl (with injected auth token) --> Response
```

### 5.2 Key Endpoints Consumed

#### Dashboard

| Method | BFF Route | Backend Route | Description |
|---|---|---|---|
| GET | `/api/dashboard/pnl` | `/v1/dashboard/pnl?period=today` | Today's P&L summary |
| GET | `/api/dashboard/positions` | `/v1/positions?status=open` | Active positions |
| GET | `/api/dashboard/trendlines` | `/v1/trendlines?status=active&limit=10` | Top 10 active trendlines |
| GET | `/api/dashboard/recent-trades` | `/v1/trades?status=closed&limit=5&sort=-entry_time` | Last 5 closed trades |
| GET | `/api/dashboard/stats` | `/v1/analytics/summary?period=[period]` | Quick stats for selected period |

#### Trendlines

| Method | BFF Route | Description |
|---|---|---|
| GET | `/api/market-data/{instrument}/{timeframe}` | Candlestick data (paginated) |
| GET | `/api/trendlines?instrument={symbol}&status={status}` | Trendline list |
| GET | `/api/trendlines/{id}` | Trendline detail |
| POST | `/api/trendlines/scan` | Trigger re-scan with custom parameters |
| PATCH | `/api/trendlines/{id}` | Update trendline (dismiss, alert config) |

#### Trade Execution

| Method | BFF Route | Description |
|---|---|---|
| GET | `/api/positions?status=open` | Active positions |
| POST | `/api/positions/{id}/close` | Close a position |
| PATCH | `/api/positions/{id}` | Modify stop/target |
| GET | `/api/signals?status=pending` | Pending signals |
| POST | `/api/orders/execute` | Execute a trade (from signal or manual) |
| PATCH | `/api/signals/{id}` | Reject or modify a signal |

#### Trade Journal

| Method | BFF Route | Description |
|---|---|---|
| GET | `/api/trades` | Trade list with filters/search/pagination |
| GET | `/api/trades/{id}` | Trade detail |
| PATCH | `/api/trades/{id}` | Update journal enrichment fields |
| DELETE | `/api/trades/bulk` | Bulk delete trades |
| POST | `/api/uploads/presign` | Get presigned URL for screenshot upload |
| POST | `/api/trades/{id}/screenshots` | Register uploaded screenshot |
| DELETE | `/api/trades/{id}/screenshots/{sid}` | Delete screenshot |

#### Playbooks

| Method | BFF Route | Description |
|---|---|---|
| GET | `/api/playbooks` | List all playbooks |
| GET | `/api/playbooks/{id}` | Playbook detail with metrics |
| POST | `/api/playbooks` | Create playbook |
| PUT | `/api/playbooks/{id}` | Update playbook |
| DELETE | `/api/playbooks/{id}` | Delete playbook |

#### Analytics

| Method | BFF Route | Description |
|---|---|---|
| GET | `/api/analytics` | Full analytics data with filter params |
| GET | `/api/analytics/equity-curve` | Equity curve data points |
| GET | `/api/analytics/calendar` | P&L calendar heatmap data |
| GET | `/api/analytics/r-distribution` | R-multiple histogram data |
| GET | `/api/analytics/time-analysis` | Time-based analysis data |
| GET | `/api/analytics/mae-mfe` | MAE/MFE scatter plot data |
| GET | `/api/analytics/drawdown` | Drawdown chart data |

#### Settings

| Method | BFF Route | Description |
|---|---|---|
| GET | `/api/settings` | All user settings |
| PUT | `/api/settings/profile` | Update profile |
| PUT | `/api/settings/preferences` | Update trading preferences |
| POST | `/api/settings/trading-mode` | Switch paper/live mode |
| PUT | `/api/settings/detection-defaults` | Update detection defaults |
| PUT | `/api/settings/risk-rules` | Update risk rules |
| PUT | `/api/settings/notifications` | Update notification preferences |

#### Brokers

| Method | BFF Route | Description |
|---|---|---|
| GET | `/api/brokers` | List broker connections |
| POST | `/api/brokers` | Add broker connection |
| POST | `/api/brokers/{id}/test` | Test broker connection |
| DELETE | `/api/brokers/{id}` | Remove broker connection |

#### AI Chat

| Method | BFF Route | Description |
|---|---|---|
| POST | `/api/chat` | Send query, receive streaming response |

### 5.3 Error Response Format

All API errors return the standard envelope with HTTP status codes:

| HTTP Status | Error Code | User-Facing Message |
|---|---|---|
| 400 | `validation_error` | Field-specific messages from `details` object |
| 401 | `unauthorized` | "Session expired. Please log in again." |
| 403 | `forbidden` | "You do not have permission to perform this action." |
| 404 | `not_found` | "The requested resource was not found." |
| 409 | `conflict` | Context-specific (e.g., "A playbook with this name already exists.") |
| 422 | `unprocessable_entity` | Context-specific (e.g., "Stop loss must be below entry price for a long position.") |
| 429 | `rate_limited` | "Too many requests. Please wait a moment and try again." |
| 500 | `internal_error` | "Something went wrong. Please try again. If the problem persists, contact support." |
| 503 | `service_unavailable` | "Service temporarily unavailable. Please try again in a few minutes." |

### 5.4 Authentication and Authorization

- All BFF API routes require a valid JWT auth token stored in an `httpOnly`, `Secure`, `SameSite=Strict` cookie.
- The BFF reads the cookie server-side and injects the `Authorization: Bearer [token]` header into backend requests.
- On 401 from the backend, the BFF attempts a token refresh using the refresh token cookie. If refresh fails, the BFF returns 401 and the frontend redirects to `/login` with a toast: "Session expired. Please log in again."
- All API responses only return data belonging to the authenticated user. There is no cross-user data access.

### 5.5 Rate Limiting

- API calls from the BFF to the backend are subject to backend rate limits (see [Cross-reference: FSD-003]).
- The frontend implements client-side debouncing and throttling to minimize unnecessary requests:
  - Search inputs: 200-300ms debounce.
  - Filter changes: 100ms debounce.
  - Form auto-save: 1000ms debounce.
  - WebSocket reconnection: exponential backoff.

### 5.6 Caching Strategy (TanStack Query)

| Data Type | Stale Time | Cache Time | Refetch On |
|---|---|---|---|
| Position data | 30 seconds | 5 minutes | WebSocket event, window focus |
| Trade list | 2 minutes | 10 minutes | Window focus, mutation |
| Analytics data | 5 minutes | 30 minutes | Filter change, window focus |
| Trendline data | 1 minute | 5 minutes | Instrument change, scan, WebSocket |
| Settings data | 1 hour | 24 hours | Mutation |
| Playbook data | 5 minutes | 30 minutes | Mutation, window focus |
| Market data (candles) | 30 seconds | 10 minutes | Timeframe/instrument change |

---

## 6. UI/UX Specifications

### 6.1 Screen/Component Inventory

| Page | Route | Primary Components |
|---|---|---|
| Dashboard | `/dashboard` | P&L Card, Positions Widget, Trendline Alerts Widget, Recent Trades Widget, Quick Stats Bar |
| Trendlines | `/trendlines` | Candlestick Chart, Trendline Overlays, Trendline List Panel, Detail Panel, Instrument Selector, Config Panel |
| Execution | `/execution` | Positions Table, Signals Queue, Trade Entry Form, Broker Status, Mode Toggle |
| Journal | `/journal` | Trade Table, Search Bar, Filter Bar |
| Trade Detail | `/journal/trade/[id]` | Mini Chart, Screenshot Gallery, Auto-Data Grid, Enrichment Form |
| Playbooks | `/playbooks` | Playbook Card Grid, Create/Edit Form |
| Playbook Detail | `/playbooks/[id]` | Metrics Cards, Equity Curve, Trade Table, Time Analysis |
| Analytics | `/analytics` | Filter Bar, Metric Cards Grid, Equity Curve, Calendar Heatmap, R-Distribution, Time Charts, MAE/MFE Scatter, Drawdown |
| AI Chat | `/chat` | Message List, Input Area, Suggested Prompts |
| Settings | `/settings/*` | Section-specific forms and configurations |
| Onboarding | `/onboarding` | Step Wizard |
| Landing | `/` | Marketing sections |

### 6.2 Design System Tokens

#### 6.2.1 Color Palette (Dark Theme - Default)

```
Background:
  --background:          hsl(222, 47%, 6%)    #0B0F19
  --card:                hsl(222, 41%, 9%)    #0E1424
  --popover:             hsl(222, 41%, 9%)    #0E1424
  --muted:               hsl(222, 30%, 15%)   #1A2035

Foreground:
  --foreground:          hsl(210, 40%, 96%)   #F1F5F9
  --card-foreground:     hsl(210, 40%, 96%)   #F1F5F9
  --muted-foreground:    hsl(215, 20%, 55%)   #7B8BA5

Border:
  --border:              hsl(222, 25%, 18%)   #232D42
  --input:               hsl(222, 25%, 22%)   #2A3550
  --ring:                hsl(217, 91%, 60%)   #3B82F6

Accent:
  --primary:             hsl(217, 91%, 60%)   #3B82F6
  --primary-foreground:  hsl(0, 0%, 100%)     #FFFFFF
  --secondary:           hsl(222, 30%, 15%)   #1A2035
  --destructive:         hsl(0, 84%, 60%)     #EF4444

Trading:
  --profit:              #22C55E
  --loss:                #EF4444
  --breakeven:           #7B8BA5
  --grade-aplus:         #F59E0B
  --grade-a:             #3B82F6
  --grade-b:             #6B7280
  --mode-paper:          #3B82F6
  --mode-live:           #22C55E
  --alert-watching:      #7B8BA5
  --alert-near:          #EAB308
  --alert-triggered:     #22C55E
```

#### 6.2.2 Color Palette (Light Theme)

```
Background:
  --background:          hsl(0, 0%, 100%)     #FFFFFF
  --card:                hsl(0, 0%, 98%)      #FAFAFA
  --muted:               hsl(210, 40%, 96%)   #F1F5F9

Foreground:
  --foreground:          hsl(222, 47%, 11%)   #0F172A
  --muted-foreground:    hsl(215, 16%, 47%)   #64748B

Border:
  --border:              hsl(214, 32%, 91%)   #E2E8F0

(Trading colors remain the same as dark theme.)
```

#### 6.2.3 Typography

```
Font Families:
  --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif
  --font-mono: 'JetBrains Mono', 'Fira Code', monospace

Scale:
  text-xs:     12px / 16px   (labels, captions, timestamps)
  text-sm:     14px / 20px   (body text, table cells, form labels)
  text-base:   16px / 24px   (default body, descriptions)
  text-lg:     18px / 28px   (section headings, card titles)
  text-xl:     20px / 28px   (page subtitles)
  text-2xl:    24px / 32px   (page titles)
  text-3xl:    30px / 36px   (hero numbers, P&L)
  text-4xl:    36px / 40px   (landing page headings)

Weights:
  font-normal:   400   (body text)
  font-medium:   500   (labels, table headers)
  font-semibold: 600   (headings, metric values)
  font-bold:     700   (emphasis, P&L amounts)

Monospace Usage:
  All prices, dollar amounts, percentages, R-multiples, and numeric metrics
  use --font-mono for tabular number alignment.
```

#### 6.2.4 Spacing

Base unit: 4px (Tailwind default).

| Token | Size | Usage |
|---|---|---|
| `p-1` / `gap-1` | 4px | Badge internal padding |
| `p-2` / `gap-2` | 8px | Table cells, between related items |
| `p-3` | 12px | Input padding |
| `p-4` / `gap-4` | 16px | Card padding (standard), between cards |
| `p-6` / `gap-6` | 24px | Section spacing |
| `p-8` / `gap-8` | 32px | Between major page areas |
| `p-10` | 40px | Page padding |

#### 6.2.5 Motion and Animation

| Animation | Duration | Easing | Usage | Reduced Motion |
|---|---|---|---|---|
| Theme transition | 200ms | ease-in-out | Background/text color change | Instant |
| Sidebar collapse | 200ms | ease-in-out | Width change | Instant |
| Modal enter | 200ms | ease-out | Dialog/Sheet open | Instant |
| Modal exit | 150ms | ease-in | Dialog/Sheet close | Instant |
| Toast enter | 300ms | spring | Slide in from right | Instant |
| Toast exit | 200ms | ease-in | Slide out right | Instant |
| Skeleton shimmer | 1.5s | linear, infinite | Loading placeholder | Static gray |
| Alert pulse | 2s | ease-in-out, infinite | Near-alert indicator | Static color |
| Chart draw | 500ms | ease-out | Initial chart render | Instant |
| Data transition | 300ms | ease-in-out | Metric value changes | Instant |
| Hover state | 150ms | ease | Button/card hover | Instant |

#### 6.2.6 Chart Color Conventions

| Data Type | Color | Hex |
|---|---|---|
| Profit / Positive | Green | `#22C55E` |
| Loss / Negative | Red | `#EF4444` |
| Breakeven / Neutral | Gray | `#7B8BA5` |
| Equity Curve (primary) | Blue | `#3B82F6` |
| Equity Curve (comparison) | Purple | `#8B5CF6` |
| Drawdown Area | Red at 30% opacity | `#EF4444` at 0.3 alpha |
| Stop Loss Level | Red dashed | `#EF4444` |
| Take Profit Level | Green dashed | `#22C55E` |
| Entry Marker | Blue dashed vertical | `#3B82F6` |
| Exit Marker | Purple dashed vertical | `#8B5CF6` |

#### 6.2.7 Icon Sizes

| Context | Size |
|---|---|
| Navigation icons | 20px |
| Inline/button icons | 16px |
| Status dots | 8px |
| Card header / empty state | 24px |
| Landing page feature icons | 32px |

---

## 7. Integration Specifications

### 7.1 FastAPI Backend (Primary Integration)

**Protocol**: REST over HTTPS via Next.js BFF API routes.

**Authentication**: JWT Bearer token injected server-side by the BFF. Never exposed to the browser.

**Error Handling**:

| Backend Response | Frontend Behavior |
|---|---|
| 200-299 | Process response, update UI |
| 400 | Display validation errors inline on form fields |
| 401 | Attempt token refresh. If fails: redirect to `/login`, toast "Session expired." |
| 403 | Toast (error): "You do not have permission to perform this action." |
| 404 | Show component-specific "not found" state |
| 409 | Toast (error) with conflict message from API |
| 422 | Display specific validation error from API |
| 429 | Toast (warning): "Too many requests. Please wait a moment." Retry with backoff. |
| 500 | Toast (error): "Something went wrong." Log to Sentry. Show retry button. |
| Timeout (>10s) | Toast (error): "Request timed out. Please try again." |
| Network error | Toast (error): "Network error. Please check your connection." |

**Retry Strategy**: Failed requests retry up to 3 times with exponential backoff (1s, 2s, 4s). Configured via TanStack Query's `retry` option. Mutations (POST/PUT/DELETE) do NOT auto-retry to prevent duplicate actions.

### 7.2 Supabase Realtime (WebSocket)

**Protocol**: WebSocket via Supabase Realtime client library.

**Connection**: Established on app mount after authentication. Auth token passed as connection parameter.

**Channels**: `positions`, `fills`, `trendlines`, `signals`, `account`, `alerts`.

**Fallback**: If WebSocket fails to connect after 5 reconnection attempts (total ~2 minutes), display a persistent banner: "Real-time updates are unavailable. Data may be outdated. Refresh the page to get the latest data." All data continues to display from the last successful fetch.

### 7.3 Cloudflare R2 (Screenshot Storage)

**Protocol**: HTTPS direct upload via presigned URL.

**Flow**:
1. Frontend requests presigned URL from BFF: `POST /api/uploads/presign`.
2. BFF generates presigned PUT URL from R2 (valid for 15 minutes).
3. Frontend uploads file directly to R2 using the presigned URL.
4. Frontend registers the uploaded file with the trade via BFF.

**Error Handling**:
- Presigned URL generation fails: Toast (error): "Unable to prepare upload. Please try again."
- Upload to R2 fails: Toast (error): "Upload failed. Please try again." Retry once automatically.
- Upload succeeds but registration fails: Toast (warning): "File uploaded but not linked to trade. Please try again."

### 7.4 Sentry (Error Monitoring)

**Integration**: Sentry SDK initialized on app mount.

**What is captured**:
- Unhandled JavaScript errors (via Error Boundaries and global handler).
- API errors (4xx and 5xx responses, with request URL and status, NOT request bodies containing sensitive data).
- WebSocket disconnection events lasting > 60 seconds.
- Performance transactions for page loads and key user interactions.

**What is NOT captured**:
- User credentials, API keys, or auth tokens.
- Trade data, P&L values, or any user financial information.
- Full request/response bodies.

### 7.5 Vercel (Hosting Platform)

**Deployment**: Automatic deployment on push to `main` branch. Preview deployments on pull requests.

**Analytics**: Vercel Web Analytics enabled for Core Web Vitals monitoring (FCP, LCP, CLS, FID).

**Edge Functions**: Next.js middleware runs at the edge for CSP header injection and theme cookie reading.

---

## 8. Security Specifications

### 8.1 Authentication

- Auth tokens (JWT) stored in `httpOnly`, `Secure`, `SameSite=Strict` cookies.
- Tokens NEVER stored in `localStorage` or `sessionStorage`.
- Tokens NEVER exposed to client-side JavaScript.
- Token refresh handled transparently by the BFF on 401 responses.
- Logout clears all auth cookies and invalidates the server-side session.

### 8.2 Authorization Matrix

| Role | Action | Resource |
|---|---|---|
| Authenticated User | Read, Create, Update, Delete | Own trades only |
| Authenticated User | Read, Create, Update, Delete | Own playbooks only |
| Authenticated User | Read, Update | Own settings only |
| Authenticated User | Read, Create | Own broker connections only |
| Authenticated User | Read | Own analytics only |
| Authenticated User | Create, Read | Own chat conversations only |
| Unauthenticated User | Read | Landing page only |
| Any User | N/A | Other users' data (NEVER accessible) |

### 8.3 XSS Prevention

- React JSX auto-escapes interpolated values.
- `dangerouslySetInnerHTML` is NEVER used except for markdown content processed through `react-markdown` with `rehype-sanitize`.
- User-generated content (notes, descriptions) rendered through sanitizer (DOMPurify) before display.
- URL parameters validated against allowlists before use in API calls.

### 8.4 Content Security Policy

```
Content-Security-Policy:
  default-src 'self';
  script-src 'self' 'unsafe-eval' 'unsafe-inline' https://vercel.live;
  style-src 'self' 'unsafe-inline';
  img-src 'self' blob: data: https://*.r2.cloudflarestorage.com;
  font-src 'self';
  connect-src 'self' wss://*.trendedge.com https://*.trendedge.com https://*.supabase.co;
  frame-src 'none';
  object-src 'none';
  base-uri 'self';
```

### 8.5 Additional Security Headers

```
X-Frame-Options: DENY
X-Content-Type-Options: nosniff
Referrer-Policy: strict-origin-when-cross-origin
Permissions-Policy: camera=(), microphone=(), geolocation=()
Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
```

### 8.6 Input Sanitization

- All form inputs validated client-side using Zod schemas before submission.
- Numeric fields reject non-numeric input at the HTML input level (`type="number"` or input filtering).
- Text fields sanitized with DOMPurify before rendering.
- File uploads validated for MIME type on client AND server.
- Search queries parameterized; no raw SQL construction on the frontend.

### 8.7 Sensitive Data Handling

- Broker credentials are submitted directly to the backend and NEVER stored on the frontend.
- API keys and secrets are NEVER included in client-side bundles.
- Source maps disabled in production (`productionBrowserSourceMaps: false`).
- Browser DevTools cannot access auth tokens (httpOnly cookies are not visible in JavaScript).

### 8.8 Audit Logging

The following user actions are logged to the backend audit log (via API):
- Paper/Live mode switches (with timestamp and user confirmation).
- Risk rule overrides (with trade details and overridden rule).
- Broker connection add/remove.
- Account deletion request.
- Bulk trade deletion.

---

## 9. Performance Specifications

### 9.1 Core Web Vitals Targets

| Metric | Target | Measurement |
|---|---|---|
| First Contentful Paint (FCP) | < 1.5 seconds (4G connection) | Vercel Analytics, Lighthouse CI |
| Largest Contentful Paint (LCP) | < 2.5 seconds | Lighthouse CI |
| Time to Interactive (TTI) | < 3 seconds (4G connection) | Lighthouse CI |
| Cumulative Layout Shift (CLS) | < 0.1 | Lighthouse CI |
| First Input Delay (FID) | < 100ms | Vercel Analytics |
| Lighthouse Performance Score | >= 90 | Lighthouse CI on every PR |
| Lighthouse Accessibility Score | >= 90 | Lighthouse CI on every PR |
| Lighthouse Best Practices Score | >= 90 | Lighthouse CI on every PR |
| Lighthouse SEO Score | >= 90 | Lighthouse CI on every PR |

### 9.2 Response Time Requirements

| Operation | Target | Notes |
|---|---|---|
| Client-side page navigation | < 500ms | Next.js client-side transitions |
| Command palette result rendering | < 100ms (local), < 300ms (API) | Local = pages/actions; API = trades/playbooks |
| WebSocket message to UI update | < 200ms | From message receipt to rendered DOM change |
| Position P&L real-time update | 1 Hz (1 update/second) | Without dropped frames |
| Chart render (300 candles + 5 trendlines) | < 16ms per frame | No frame drops |
| Analytics dashboard render (1000 trades) | < 3 seconds | All charts and metrics |
| Trade table render (10,000 rows) | Smooth scrolling | Virtualized via `@tanstack/react-virtual` |
| Chart render (2,000 candles) | No frame drops | TradingView Lightweight Charts |
| Search result rendering | < 300ms after debounce | Full-text trade search |
| Form auto-save round-trip | < 2 seconds | Debounce (1s) + API call (< 1s) |
| Screenshot upload | Progress bar during upload | Presign + direct R2 upload |

### 9.3 Bundle Size Targets

| Bundle | Target (gzipped) | Enforcement |
|---|---|---|
| Initial JS (first load) | < 150 KB | `next build` output |
| Per-route JS chunk | < 50 KB | `next build` output |
| TradingView Lightweight Charts | < 45 KB | Dynamic import, chart pages only |
| D3.js (tree-shaken) | < 30 KB | Dynamic import, analytics page only |
| Total CSS | < 30 KB | Tailwind purge output |

**Enforcement**: Bundle analyzer (`@next/bundle-analyzer`) runs in CI. Alert if any chunk exceeds target by > 10%.

### 9.4 Data Volume Handling

| Data | Volume Limit | Strategy |
|---|---|---|
| Trade table rows | Up to 10,000 | Virtualized rendering (`@tanstack/react-virtual`) |
| Analytics computation | Up to 5,000 trades | Server-side computation, client renders results |
| Chart candles | Up to 2,000 | TradingView Lightweight Charts native handling |
| Trendlines per instrument | Up to 100 | Direct rendering (no virtualization needed) |
| Concurrent open positions | Up to 10 | Direct rendering |

### 9.5 Caching Strategy

Implemented via TanStack Query. See section 5.6 for cache TTL details.

**Stale-While-Revalidate**: Stale cached data is served immediately while a background refetch occurs. Users see content instantly; updates arrive asynchronously.

**Cache Invalidation Triggers**:
- WebSocket events invalidate related query caches.
- Mutations (create/update/delete) invalidate related list queries.
- Window focus triggers refetch for stale data.
- Manual "Retry" button invalidates and refetches the specific query.

### 9.6 Offline Resilience

When network connectivity is lost:
1. Banner at top of page: "You are offline. Some features may be unavailable." (yellow background, dismissible).
2. Cached data remains visible and readable.
3. Write operations (journal edits, settings changes) are queued in an IndexedDB-backed queue and synced when connectivity returns.
4. Real-time data shows "stale" indicator (yellow clock icon) with the timestamp of the last update.
5. On reconnection: queued writes are replayed in order. If a write conflicts with newer server data, the server data wins and the user is notified via toast: "Some offline changes could not be saved because the data was updated elsewhere."

---

## 10. Testing Specifications

### 10.1 Unit Testing

**Framework**: Jest + React Testing Library

**Coverage Targets**:
- Component coverage: > 80% of exported components.
- Branch coverage: > 70%.
- Test execution time: < 60 seconds for full suite.

**Key Test Scenarios**:

| Component / Feature | Test Cases |
|---|---|
| P&L Summary Card | Renders positive P&L in green, negative in red, zero in muted. Shows "(Paper)" label in paper mode. Shows "Markets closed" on weekends. |
| Active Positions Widget | Renders correct column data. Shows empty state when no positions. Shows stale indicator when WebSocket disconnected. |
| Trendline Overlays | Correct color by grade (A+=gold, A=blue, B=gray dashed). Touch point tooltips display date+price. Selected trendline has increased width. |
| Manual Trade Entry Form | All validation rules fire with correct error messages. Calculated fields update in real-time. Stop loss validation is direction-aware. Submit disabled until valid. |
| Journal Enrichment | Max 3 emotional states enforced with error message. Character count displayed. Auto-save debounce fires correctly. |
| Screenshot Upload | Rejects files > 5MB with correct message. Rejects unsupported formats. Limits to 10 files per trade. |
| Playbook CRUD | Name uniqueness check. 2-50 char validation. System playbooks cannot be deleted. |
| Paper/Live Toggle | Paper-to-live requires checkbox acknowledgment. Live-to-paper is single-click. 60-day warning displays when applicable. |
| Trade Table | Sorts correctly ascending/descending for all sortable columns. Pagination renders correct ranges. Winning trades have green border, losing have red. |
| Toast System | Auto-dismiss at correct intervals (5s success, 8s error). Max 3 visible. Queue works. Hover pauses timer. |
| Theme Toggle | Reads from localStorage/cookie. Falls back to system preference. Falls back to dark. Transition animates. |
| Keyboard Shortcuts | `Cmd+K` opens palette. `G` then `D` navigates. Suppressed in text inputs. |
| Command Palette | Filters results by substring. Highlights matches. Arrow keys navigate. Enter selects. Escape closes. |
| Risk Rules | Violations block trade with specific message. Override logs warning. |
| Zustand Stores | Mode changes propagate globally. Sidebar state persists. |

### 10.2 End-to-End Testing

**Framework**: Playwright

**Targets**:
- 100% coverage of critical user journeys (see below).
- Execution time: < 5 minutes for full suite.
- Browsers: Chromium, Firefox, WebKit.

**Critical User Journeys**:

| # | Journey | Key Assertions |
|---|---|---|
| 1 | Authentication | Sign up creates account. Login redirects to dashboard. Protected routes redirect to login. Logout clears session. |
| 2 | Dashboard Load | All 5 widgets render with data. P&L card shows correct amount. Positions widget shows open trades. |
| 3 | Trendline Interaction | Select instrument > chart renders > trendlines appear > click trendline > detail panel shows correct data > adjust params > apply > new results |
| 4 | Trade Entry | Open form > fill all fields > verify calculated R:R > submit > toast appears > trade in journal |
| 5 | Journal Workflow | View table > sort by P&L > filter by instrument > click trade > add conviction (3 stars) > add notes > upload screenshot > verify auto-save |
| 6 | Playbook CRUD | Create playbook > verify in list > edit name > view detail page with metrics > delete > confirm removal |
| 7 | Analytics Filtering | Navigate to analytics > change date range > change instrument filter > verify all charts update with filtered data |
| 8 | Paper/Live Toggle | Click badge > dialog opens > check checkbox > switch to live > verify green badge > switch back to paper > verify blue badge |
| 9 | Settings | Update notification preferences (toggle) > test broker connection > change theme to light > verify theme changes |
| 10 | Command Palette | `Cmd+K` > type "journal" > see Journal in results > press Enter > verify navigation to journal page |
| 11 | Responsive | Run journeys 2, 4, 5 at 375px viewport width > verify mobile layout > drawer nav > stacked cards |

### 10.3 Visual Regression Testing

**Framework**: Playwright screenshot comparison or Chromatic (Storybook)

**Process**:
- Capture screenshots of all major pages in both dark and light themes.
- Compare against baselines on every PR.
- Pixel difference tolerance: 0.1%.

**Critical Screenshots**:
- Dashboard (all widgets loaded)
- Trade table (with data, with empty state)
- Trendline chart (with overlays)
- Analytics metrics grid
- P&L calendar heatmap
- Equity curve chart
- Trade detail view (with screenshots)
- Settings page (each section)
- Paper mode header vs. Live mode header

### 10.4 Accessibility Testing

**Framework**: axe-core (`@axe-core/playwright` for E2E, `jest-axe` for unit)

- Every page: zero "critical" and "serious" axe-core violations.
- "Moderate" and "minor" logged as warnings.
- Manual testing: keyboard-only navigation through all critical journeys.
- Screen reader testing: VoiceOver (macOS) for dashboard and trade journal.

### 10.5 Performance Testing

**Framework**: Lighthouse CI (`@lhci/cli`)

- Runs on every PR against Vercel preview deployment.
- Assertions: Performance >= 90, Accessibility >= 90, Best Practices >= 90, SEO >= 90, FCP <= 1500ms, LCP <= 2500ms, TTI <= 3000ms, CLS <= 0.1.
- Performance budget file (`budget.json`) enforces bundle size limits.
- Regression alert: If any metric drops > 5 points from baseline, PR is flagged.

### 10.6 Cross-Browser Testing

| Browser | Version | Priority | Testing Level |
|---|---|---|---|
| Chrome | Latest 2 | P0 | Full E2E + visual regression |
| Firefox | Latest 2 | P0 | Full E2E |
| Safari | Latest 2 | P0 | Full E2E |
| Edge | Latest 2 | P1 | Smoke test (critical journeys) |
| Mobile Safari (iOS) | Latest | P1 | Responsive smoke test |
| Chrome (Android) | Latest | P1 | Responsive smoke test |

**Responsive Breakpoint Testing**: 375px (iPhone SE), 390px (iPhone 14), 768px (iPad), 1024px (iPad Pro landscape). Verified: no horizontal overflow, 44px minimum touch targets, charts usable with touch gestures.

---

## 11. Migration & Deployment

### 11.1 Deployment Pipeline

1. Developer pushes code to a feature branch.
2. GitHub Actions CI runs: TypeScript check (`tsc --noEmit`), ESLint, Prettier, Jest unit tests, Playwright E2E tests, Lighthouse CI.
3. Vercel automatically creates a preview deployment for the PR.
4. Manual review on the preview deployment.
5. On merge to `main`: Vercel automatically deploys to production.

### 11.2 Feature Flags

Feature flags are implemented via environment variables and a simple `featureFlags` utility:

| Flag | Default | Purpose |
|---|---|---|
| `NEXT_PUBLIC_ENABLE_AI_CHAT` | `false` | Gates the AI Chat page and nav item (Phase 2) |
| `NEXT_PUBLIC_ENABLE_ONBOARDING` | `false` | Gates the onboarding wizard (Phase 3) |
| `NEXT_PUBLIC_ENABLE_LANDING_PAGE` | `false` | Gates the marketing landing page (Phase 3) |
| `NEXT_PUBLIC_ENABLE_PLAYBOOK_COMPARISON` | `false` | Gates the playbook comparison view (Phase 2) |
| `NEXT_PUBLIC_ENABLE_LIGHT_MODE` | `false` | Gates the light mode theme toggle (Phase 3) |

When a feature flag is `false`:
- The corresponding navigation item is hidden.
- The route returns a 404 page.
- Related API calls are not made.

### 11.3 Rollback Procedures

- Vercel supports instant rollback to any previous deployment via the dashboard or CLI.
- Rollback command: `vercel rollback [deployment-url]`.
- If a deployment introduces a critical bug, roll back within 5 minutes. No database migrations are involved in frontend deployments.
- WebSocket compatibility: Ensure the backend WebSocket contract has not changed before rolling back the frontend.

### 11.4 Deployment Dependencies

| Dependency | Must Be Deployed Before Frontend |
|---|---|
| FastAPI Backend | Yes. API endpoints must exist before frontend pages that consume them. |
| Supabase Project | Yes. WebSocket channels must be configured. |
| Cloudflare R2 Bucket | Yes. Screenshot upload bucket must exist with CORS configured. |
| Sentry Project | Yes. DSN must be configured in environment variables. |
| Vercel Project | N/A. This IS the frontend deployment target. |

### 11.5 Environment Variables

| Variable | Required | Description |
|---|---|---|
| `BACKEND_URL` | Yes | FastAPI backend base URL (server-side only) |
| `NEXT_PUBLIC_WS_URL` | Yes | WebSocket URL for Supabase Realtime |
| `NEXT_PUBLIC_SENTRY_DSN` | Yes | Sentry error reporting DSN |
| `R2_PRESIGN_SECRET` | Yes | Secret for R2 presigned URL generation (server-side only) |
| `NEXT_PUBLIC_ENABLE_*` | No | Feature flags (see 11.2) |

---

## 12. Open Questions & Assumptions

### 12.1 Assumptions

| # | Assumption | Impact if Wrong |
|---|---|---|
| A1 | The FastAPI backend provides all required endpoints as specified in Section 5.2 before the corresponding frontend phase begins. | Frontend pages will show error states until endpoints are available. |
| A2 | Supabase Realtime supports all 6 WebSocket channels with the required event types. | Real-time updates may need to be polled instead. |
| A3 | TradingView Lightweight Charts v4.x supports all required trendline overlay features (line series, touch points, glow effects). | Custom canvas rendering may be required for unsupported features. |
| A4 | The user base during MVP will not exceed 1,000 concurrent users. | Scaling concerns for WebSocket connections and API rate limits. |
| A5 | All 8 supported instruments have sufficient historical data (at least 1 year of 4H candles) available via the backend. | Charts may show limited data for newer instruments. |
| A6 | D3.js tree-shaking can achieve < 30KB gzipped for the analytics charts. | May need an alternative lightweight charting library or custom SVG. |
| A7 | The `openapi-typescript` code generation tool can produce accurate TypeScript types from the FastAPI OpenAPI spec. | Manual type definitions may be required. |
| A8 | Vercel Edge Functions support the required CSP header injection and cookie reading for SSR theme detection. | May need to move to Node.js middleware. |

### 12.2 Open Questions

| # | Question | Needed By | Impact |
|---|---|---|---|
| Q1 | What is the exact list of futures instruments supported beyond the 8 MVP instruments? | Phase 2 | Instrument selector and search scope |
| Q2 | Should the AI chat support conversation persistence across sessions (saved to database) or only in-memory per session? | Phase 2 | Chat history API and storage requirements |
| Q3 | What is the pricing for each subscription tier (Free, Trader, Pro, Team) and what features are gated per tier? | Phase 3 | Landing page pricing section and feature gating logic |
| Q4 | Is there a preference for Chromatic vs. Playwright for visual regression testing? | Phase 1 | Testing infrastructure setup |
| Q5 | What specific TradingView webhook payload format should the pending signals queue expect? | Phase 2 | Signal card rendering and execution flow |
| Q6 | Should the frontend support multi-language/internationalization (i18n)? | Phase 3+ | Architecture decision for string handling |
| Q7 | What are the specific correlation rules for the "Correlation Limit" risk management rule? (Which instruments are considered correlated?) | Phase 2 | Risk rule enforcement logic |

### 12.3 Deferred Decisions

| # | Decision | Deferred To | Reason |
|---|---|---|---|
| D1 | Mobile app (React Native) vs. progressive web app (PWA) | Post-MVP | Need to validate web platform adoption first |
| D2 | Multi-user/team features (shared playbooks, team analytics) | Phase 4+ | Single-user focus for MVP |
| D3 | Custom alert sound notifications | Phase 3+ | Low priority relative to core features |
| D4 | Advanced chart drawing tools (manual trendline drawing, Fibonacci, etc.) | Phase 3+ | Automated detection is the primary value proposition |

---

## 13. Appendices

### 13.1 Glossary

| Term | Definition |
|---|---|
| ATR | Average True Range. A volatility indicator measuring the average range of price bars. Used for normalizing distances. |
| BFF | Backend for Frontend. A server-side proxy layer (Next.js API routes) that mediates between the browser and the backend API. |
| Bracket Order | A trade entry with attached stop loss and take profit orders. |
| Candlestick | A chart type showing open, high, low, close (OHLC) prices for each time period. |
| CLS | Cumulative Layout Shift. A Core Web Vital measuring visual stability. |
| Contracts | The unit of trading in futures markets (equivalent to "shares" in equity markets). |
| Conviction | A trader's self-assessed confidence level (1-5) in a trade at the time of entry. |
| Drawdown | The decline from a peak equity value to a trough. Measured in dollars or percentage. |
| Equity Curve | A line chart showing cumulative account P&L over time. |
| Expectancy | The average expected profit per trade, calculated as (Win% x Avg Win) - (Loss% x Avg Loss). |
| FCP | First Contentful Paint. A Core Web Vital measuring perceived load speed. |
| Futures | Standardized contracts to buy or sell an asset at a future date and price. |
| ISR | Incremental Static Regeneration. A Next.js feature for static page updates without full rebuilds. |
| LCP | Largest Contentful Paint. A Core Web Vital measuring loading performance. |
| MAE | Maximum Adverse Excursion. The largest unrealized loss experienced during a trade. |
| Margin | The collateral required to hold a futures position. |
| MFE | Maximum Favorable Excursion. The largest unrealized profit experienced during a trade. |
| P&L | Profit and Loss. The financial result of trading activity. |
| Paper Trading | Simulated trading with no real money. Used for practice and system testing. |
| Playbook | A named trading strategy with associated rules, metrics, and trade assignments. |
| Profit Factor | Gross profit divided by gross loss. Values > 1 indicate profitability. |
| R-Multiple | Trade result expressed as a multiple of the initial risk (stop distance). 1R = captured exactly the risked amount. |
| RSC | React Server Components. Components that render on the server, reducing client JavaScript. |
| RTH | Regular Trading Hours. The main market session (e.g., 9:30 AM - 4:00 PM ET for equity index futures). |
| Sharpe Ratio | Risk-adjusted return metric: (mean return - risk-free rate) / standard deviation. |
| Slippage | The difference between expected fill price and actual fill price. |
| Sortino Ratio | Risk-adjusted return metric using only downside deviation (not total standard deviation). |
| Trendline | A straight line connecting swing points on a chart, indicating support or resistance. |
| TTI | Time to Interactive. A Core Web Vital measuring when the page becomes fully interactive. |

### 13.2 Related FSDs

| FSD | Relationship |
|---|---|
| FSD-001 | Infrastructure: hosting, CI/CD, environment config |
| FSD-002 | Database: entity schemas, data model definitions |
| FSD-003 | Auth: login/signup flows, token management, protected routes |
| FSD-004 | Trendline detection: algorithm details, scoring logic |
| FSD-005 | Trade execution: order routing, broker integration internals |
| FSD-006 | Trade journaling: storage, auto-capture logic |
| FSD-007 | Playbook system: auto-classification engine, metric computation |
| FSD-008 | Analytics: metric calculation formulas, data aggregation |
| FSD-009 | Notifications: delivery pipeline, channel integrations |
| FSD-010 | AI features: Claude API integration, prompt engineering, response formatting |

### 13.3 Phase Summary

| Phase | Timeline | Scope | Key Deliverables |
|---|---|---|---|
| Phase 1 | Weeks 7-8 | Core Dashboard | App shell, dashboard widgets, trendline chart, trade table, equity curve, WebSocket, dark mode |
| Phase 2 | Weeks 9-14 | Analytics & Journaling | Journal enrichment, screenshots, playbooks, 27 analytics metrics, all charts, AI chat, trade execution, Paper/Live toggle |
| Phase 3 | Weeks 17-18 | Polish & Onboarding | Settings, onboarding wizard, landing page, keyboard shortcuts, command palette, accessibility, light mode, full testing |

---

## Changelog

- 2026-02-11: Initial FSD created from PRD-011 -- Generated by Claude

---

*End of FSD-011: Frontend Dashboard & UI/UX*
